# Cursor Rules for BarnabeeNet

## Project Context
BarnabeeNet is a privacy-first, multi-agent AI smart home assistant built with FastAPI, Redis, and vanilla JavaScript.

## Key Architecture Points

### Agents
- **MetaAgent**: Intent classification (runs on every request)
- **InstantAgent**: Pattern-matched responses (no LLM)
- **ActionAgent**: Device control via Home Assistant
- **InteractionAgent**: Complex conversations (uses Claude/GPT-4)
- **MemoryAgent**: Memory storage/retrieval
- **SelfImprovementAgent**: AI-assisted code improvements

### File Structure
- Agent prompts: `src/barnabeenet/prompts/*.txt` - **EDIT DIRECTLY, NO UI**
- Agent code: `src/barnabeenet/agents/*.py`
- Model config: `config/llm.yaml` (one model per agent)
- Dashboard: `src/barnabeenet/static/` (HTML/JS/CSS)

### Dashboard Pages
- Dashboard, Chat, Memory, Logic, Self-Improve, Logs, Family, Entities, Config
- **REMOVED:** Prompts page (edit files directly)

### Model Configuration
- Each agent has ONE model in `config/llm.yaml`
- Dashboard shows read-only display
- Edit YAML file to change models

## Development Rules

1. **Always run tests:** `pytest` (uses testmon for fast incremental runs)
2. **IMPORTANT - Commit and Deploy:** After making code changes, ALWAYS:
   - Commit changes: `git add -A && git commit -m "description"`
   - Push to origin: `git push`
   - Deploy to VM: `ssh thom@192.168.86.51 'cd ~/barnabeenet && git pull && bash scripts/restart.sh'`
   - Changes are NOT live until deployed to the VM at 192.168.86.51
3. **Deploy to VM:** Use `./scripts/deploy-vm.sh` or the SSH command above
4. **WSL Usage:** Only for GPU workers, NOT main API
5. **Edit prompts:** Direct file edit in `prompts/*.txt`, no UI
6. **Change models:** Edit `config/llm.yaml`, restart service

## Code Style
- Python 3.12+ with strict typing
- Pydantic v2 models
- Async-first design
- Ruff for formatting

## Safety
- Never modify `secrets/`, `.env`, authentication code
- Never run destructive commands (`rm -rf`, `sudo`, etc.)
- Never commit secrets

## Testing
- Run `pytest` after changes (testmon auto-selects affected tests)
- ~690 tests currently passing
- Use `pytest --no-testmon` for full test suite
