<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0a0e14">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>BarnabeeNet Dashboard</title>
    <link rel="stylesheet" href="/static/style.css?v=2">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <!-- Offline Banner -->
    <div class="offline-banner" id="offline-banner">
        ‚ö†Ô∏è You appear to be offline. Some features may be unavailable.
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <nav class="navbar">
        <div class="nav-brand">
            <span class="logo">üêù</span>
            <span class="brand-name">BarnabeeNet Dashboard</span>
        </div>
        <div class="nav-links">
            <a href="#" class="nav-link active" data-page="dashboard">Dashboard</a>
            <a href="#" class="nav-link" data-page="chat">Chat</a>
            <a href="#" class="nav-link" data-page="memory">Memory</a>
            <a href="#" class="nav-link" data-page="self-improve">Self-Improve</a>
            <a href="#" class="nav-link" data-page="logs">Logs</a>
            <a href="#" class="nav-link" data-page="family">Family</a>
            <a href="#" class="nav-link" data-page="entities">Entities</a>
            <a href="#" class="nav-link" data-page="config">Configuration</a>
        </div>
        <div class="nav-status">
            <span class="status-indicator" id="ws-status"></span>
            <span id="current-time"></span>
        </div>
    </nav>

    <main class="main-content">
        <!-- Dashboard Page -->
        <div id="page-dashboard" class="page active">
            <div class="page-header">
                <h1>BarnabeeNet Dashboard</h1>
                <p>Monitor your smart home AI system status and activity</p>
            </div>

            <div class="dashboard-grid">
                <!-- System Status -->
                <div class="card">
                    <div class="card-header">
                        <h3>üñ•Ô∏è System Status</h3>
                    </div>
                    <div class="card-body" id="system-status">
                        <div class="status-row">
                            <span class="status-label">Status:</span>
                            <span class="status-value status-loading">Loading...</span>
                        </div>
                    </div>
                </div>

                <!-- Services Health -->
                <div class="card">
                    <div class="card-header">
                        <h3>üíö Services</h3>
                    </div>
                    <div class="card-body" id="services-health">
                        <div class="status-row">
                            <span class="status-label">Loading...</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="card">
                    <div class="card-header">
                        <h3>üìä Statistics</h3>
                    </div>
                    <div class="card-body" id="quick-stats">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="stat-value" id="stat-requests">-</span>
                                <span class="stat-label">Requests</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value" id="stat-signals">-</span>
                                <span class="stat-label">Signals</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value" id="stat-memories">-</span>
                                <span class="stat-label">Memories</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value" id="stat-actions">-</span>
                                <span class="stat-label">Actions</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Errors -->
                <div class="card">
                    <div class="card-header">
                        <h3>‚ö†Ô∏è Recent Errors</h3>
                    </div>
                    <div class="card-body" id="recent-errors">
                        <p class="text-muted">No recent errors</p>
                    </div>
                </div>
            </div>

            <!-- Activity Feed -->
            <div class="card full-width">
                <div class="card-header">
                    <h3>üì° Live Activity Feed</h3>
                    <div class="card-actions">
                        <select id="activity-filter" class="filter-select">
                            <option value="">All Types</option>
                            <optgroup label="Categories">
                                <option value="category:ha">üè† Home Assistant Only</option>
                                <option value="category:llm">ü§ñ LLM Only</option>
                                <option value="category:agent">üß† Agents Only</option>
                                <option value="category:memory">üìù Memory Only</option>
                            </optgroup>
                            <optgroup label="Pipeline">
                                <option value="request_start">Requests</option>
                                <option value="stt">STT</option>
                                <option value="meta_classify">Classification</option>
                                <option value="tts">TTS</option>
                            </optgroup>
                            <optgroup label="Agents">
                                <option value="instant">Instant Agent</option>
                                <option value="action">Action Agent</option>
                                <option value="interaction">Interaction Agent</option>
                                <option value="memory">Memory Agent</option>
                            </optgroup>
                            <optgroup label="LLM">
                                <option value="llm_request">LLM Calls</option>
                                <option value="llm.error">LLM Errors</option>
                            </optgroup>
                            <optgroup label="Home Assistant">
                                <option value="ha.state_change">State Changes</option>
                                <option value="ha.service_call">Service Calls</option>
                                <option value="ha.event">HA Events</option>
                            </optgroup>
                            <optgroup label="System">
                                <option value="error">Errors</option>
                                <option value="system">System</option>
                            </optgroup>
                        </select>
                        <button class="btn btn-small" id="clear-activity">Clear</button>
                        <label class="toggle-label">
                            <input type="checkbox" id="auto-scroll" checked>
                            Auto-scroll
                        </label>
                    </div>
                </div>
                <div class="card-body">
                    <div class="activity-feed" id="activity-feed">
                        <div class="activity-item info">
                            <span class="activity-time">--:--:--</span>
                            <span class="activity-badge system">System</span>
                            <span class="activity-message">Connecting to activity stream...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Request Traces -->
            <div class="card full-width">
                <div class="card-header">
                    <h3>üîç Recent Request Traces</h3>
                    <div class="card-actions">
                        <button class="btn btn-small" id="refresh-traces">üîÑ Refresh</button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="traces-list" id="traces-list">
                        <p class="text-muted">Loading traces...</p>
                    </div>
                </div>
            </div>

            <!-- Active Timers -->
            <div class="card" id="active-timers-card">
                <div class="card-header">
                    <h3>‚è±Ô∏è Active Timers</h3>
                    <div class="card-actions">
                        <button class="btn btn-small" id="refresh-timers-btn">üîÑ Refresh</button>
                    </div>
                </div>
                <div class="card-body" id="active-timers">
                    <p class="text-muted">No active timers</p>
                </div>
            </div>

            <!-- Active Self-Improvement Sessions -->
            <div class="card" id="active-si-sessions-card">
                <div class="card-header">
                    <h3>üîß Self-Improvement Sessions</h3>
                    <button class="btn btn-primary btn-small" onclick="showPage('self-improve')">View All</button>
                </div>
                <div class="card-body" id="active-si-sessions">
                    <p class="text-muted">No active sessions</p>
                </div>
            </div>

            <!-- Trace Detail Modal -->
            <div id="trace-modal" class="modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>üî¨ Request Trace Detail</h3>
                        <button class="btn btn-small" id="close-modal">‚úï</button>
                    </div>
                    <div class="modal-body" id="trace-detail">
                        <!-- Populated dynamically -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat Page - Talk to Barnabee -->
        <div id="page-chat" class="page">
            <div class="chat-container">
                <!-- Chat Header -->
                <div class="chat-header">
                    <div class="chat-avatar">üêù</div>
                    <div class="chat-info">
                        <h2>Barnabee</h2>
                        <span class="chat-status" id="chat-status">Ready to chat</span>
                    </div>
                    <div class="chat-actions">
                        <button id="chat-clear-btn" class="btn btn-secondary" title="Clear conversation">
                            üóëÔ∏è Clear
                        </button>
                    </div>
                </div>

                <!-- Chat Messages Area -->
                <div class="chat-messages" id="chat-messages">
                    <div class="chat-welcome">
                        <div class="welcome-avatar">üêù</div>
                        <h3>Hello! I'm Barnabee</h3>
                        <p>Your friendly home assistant. I can help you with:</p>
                        <div class="welcome-suggestions">
                            <button class="suggestion-chip" data-suggestion="What time is it?">üïê Time</button>
                            <button class="suggestion-chip" data-suggestion="What's the weather?">üå§Ô∏è Weather</button>
                            <button class="suggestion-chip" data-suggestion="Morning briefing">üìã Briefing</button>
                            <button class="suggestion-chip" data-suggestion="Tell me a joke">üòÑ Joke</button>
                            <button class="suggestion-chip" data-suggestion="Tell me a riddle">üß© Riddle</button>
                            <button class="suggestion-chip" data-suggestion="Flip a coin">ü™ô Coin flip</button>
                        </div>
                    </div>
                </div>

                <!-- Chat Input -->
                <div class="chat-input-container">
                    <!-- STT Settings Row -->
                    <div class="stt-settings-row" id="stt-settings-row">
                        <div class="stt-setting">
                            <label for="stt-mode-select">Mode:</label>
                            <select id="stt-mode-select" class="stt-select" title="STT processing mode">
                                <option value="command" selected>Command (single utterance)</option>
                                <option value="realtime">Real-time (streaming)</option>
                                <option value="ambient">Ambient (continuous)</option>
                            </select>
                        </div>
                        <div class="stt-setting">
                            <label for="stt-engine-select">Engine:</label>
                            <select id="stt-engine-select" class="stt-select" title="STT engine">
                                <option value="auto" selected>Auto (best available)</option>
                                <option value="parakeet">Parakeet (GPU)</option>
                                <option value="whisper">Whisper (CPU)</option>
                                <option value="azure">Azure (Cloud)</option>
                            </select>
                        </div>
                        <div class="stt-status" id="stt-status-indicator">
                            <span class="stt-status-dot"></span>
                            <span class="stt-status-text">Checking...</span>
                        </div>
                    </div>
                    <div class="chat-input-wrapper">
                        <button id="chat-mic-btn" class="chat-mic-btn" title="Click to record voice">
                            <span class="mic-icon">üé§</span>
                        </button>
                        <input type="text" id="chat-input" class="chat-input" placeholder="Type or click üé§ to speak..."
                            autocomplete="off">
                        <button id="chat-send-btn" class="chat-send-btn" title="Send message">
                            <span class="send-icon">‚û§</span>
                        </button>
                    </div>
                    <!-- Quick action buttons below chat -->
                    <div class="chat-quick-actions">
                        <button class="btn btn-secondary btn-sm" id="chat-self-improve-btn"
                            title="Send to Self-Improvement Agent">
                            üîß Fix This
                        </button>
                    </div>
                    <div class="chat-voice-indicator" id="chat-voice-indicator">
                        <div class="voice-wave">
                            <span></span><span></span><span></span><span></span><span></span>
                        </div>
                        <span class="voice-status">Listening...</span>
                    </div>
                    <div class="chat-input-hint">
                        Press <kbd>Enter</kbd> to send ‚Ä¢ Click <kbd>üé§</kbd> to record ‚Ä¢ Barnabee responds with
                        personality!
                    </div>
                </div>
            </div>
        </div>

        <!-- Memory Page - Barnabee's Memories -->
        <div id="page-memory" class="page">
            <div class="page-header">
                <h1>üß† Barnabee's Memory</h1>
                <p>View and manage what Barnabee knows about your household</p>
            </div>

            <!-- Memory Stats Cards -->
            <div class="memory-stats-row">
                <div class="stat-card">
                    <div class="stat-icon">üìö</div>
                    <div class="stat-value" id="memory-total">0</div>
                    <div class="stat-label">Total Memories</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üÜï</div>
                    <div class="stat-value" id="memory-24h">0</div>
                    <div class="stat-label">Last 24 Hours</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìÖ</div>
                    <div class="stat-value" id="memory-7d">0</div>
                    <div class="stat-label">Last 7 Days</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üíæ</div>
                    <div class="stat-value" id="memory-backend">-</div>
                    <div class="stat-label">Storage Backend</div>
                </div>
            </div>

            <!-- Memory Tabs -->
            <div class="memory-tabs">
                <button class="memory-tab active" data-tab="all">üìã All Memories</button>
                <button class="memory-tab" data-tab="semantic">üí° Facts & Knowledge</button>
                <button class="memory-tab" data-tab="episodic">üìù Conversations</button>
                <button class="memory-tab" data-tab="diary">üìñ Diary</button>
                <button class="memory-tab" data-tab="search">üîç Search</button>
                <button class="memory-tab" data-tab="add">‚ûï Add Memory</button>
            </div>

            <!-- Tab Content: All Memories -->
            <div class="memory-tab-content active" id="tab-all">
                <div class="memory-filters">
                    <select id="memory-type-filter" class="form-control">
                        <option value="">All Types</option>
                        <option value="semantic">Semantic (Facts)</option>
                        <option value="episodic">Episodic (Events)</option>
                        <option value="procedural">Procedural (Routines)</option>
                    </select>
                    <select id="memory-participant-filter" class="form-control">
                        <option value="">All Participants</option>
                    </select>
                    <button id="memory-refresh-btn" class="btn btn-secondary">üîÑ Refresh</button>
                </div>
                <div class="memory-list" id="memory-list">
                    <div class="loading">Loading memories...</div>
                </div>
                <div class="memory-pagination" id="memory-pagination"></div>
            </div>

            <!-- Tab Content: Facts & Knowledge -->
            <div class="memory-tab-content" id="tab-semantic">
                <div class="memory-category-intro">
                    <h3>üí° Semantic Memories</h3>
                    <p>Long-term facts about the household: preferences, relationships, and general knowledge.</p>
                </div>
                <div class="memory-list" id="semantic-list">
                    <div class="loading">Loading facts...</div>
                </div>
            </div>

            <!-- Tab Content: Conversations -->
            <div class="memory-tab-content" id="tab-episodic">
                <div class="memory-category-intro">
                    <h3>üìù Episodic Memories</h3>
                    <p>Specific events and conversations from interactions.</p>
                </div>
                <div class="memory-list" id="episodic-list">
                    <div class="loading">Loading events...</div>
                </div>
            </div>

            <!-- Tab Content: Diary -->
            <div class="memory-tab-content" id="tab-diary">
                <div class="memory-category-intro">
                    <h3>üìñ Daily Diary</h3>
                    <p>Barnabee's daily journal entries summarizing household activity.</p>
                    <div class="diary-actions">
                        <button id="generate-diary-btn" class="btn btn-primary">‚ú® Generate Today's Entry</button>
                        <input type="date" id="diary-date-picker" class="form-control" />
                    </div>
                </div>
                <div class="diary-entries" id="diary-entries">
                    <div class="loading">Loading diary...</div>
                </div>
            </div>

            <!-- Tab Content: Search -->
            <div class="memory-tab-content" id="tab-search">
                <div class="memory-search-form">
                    <h3>üîç Search Memories</h3>
                    <p>Find specific memories using semantic search.</p>
                    <div class="search-input-row">
                        <input type="text" id="memory-search-input" class="form-control"
                            placeholder="What is Thom's favorite color?" />
                        <button id="memory-search-btn" class="btn btn-primary">Search</button>
                    </div>
                </div>
                <div class="memory-search-results" id="memory-search-results">
                    <p class="search-hint">Enter a question or topic to search Barnabee's memories.</p>
                </div>
            </div>

            <!-- Tab Content: Add Memory -->
            <div class="memory-tab-content" id="tab-add">
                <div class="memory-add-form">
                    <h3>‚ûï Add New Memory</h3>
                    <p>Manually store information for Barnabee to remember.</p>
                    <div class="form-group">
                        <label>Memory Content</label>
                        <textarea id="add-memory-content" class="form-control" rows="3"
                            placeholder="e.g., Thom's favorite color is blue"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Type</label>
                            <select id="add-memory-type" class="form-control">
                                <option value="semantic">Semantic (Fact/Preference)</option>
                                <option value="episodic">Episodic (Event)</option>
                                <option value="procedural">Procedural (Routine)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Importance (0-1)</label>
                            <input type="number" id="add-memory-importance" class="form-control" value="0.5" min="0"
                                max="1" step="0.1" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Participants (comma-separated)</label>
                        <input type="text" id="add-memory-participants" class="form-control"
                            placeholder="e.g., Thom, Heidi" />
                    </div>
                    <div class="form-group">
                        <label>Tags (comma-separated)</label>
                        <input type="text" id="add-memory-tags" class="form-control"
                            placeholder="e.g., preference, color" />
                    </div>
                    <button id="add-memory-btn" class="btn btn-primary">üíæ Store Memory</button>
                </div>
            </div>
        </div>

        <!-- Logs Page -->
        <div id="page-logs" class="page">
            <div class="page-header">
                <h1>üìã System Logs</h1>
                <p>Real-time log stream with filtering and performance graphs</p>
            </div>

            <!-- Live Activity Stats Bar -->
            <div class="card full-width" style="margin-bottom: 20px;">
                <div class="activity-stats-bar">
                    <div class="stat">
                        <span id="events-per-sec">0.0</span>
                        <span>Events/sec</span>
                    </div>
                    <div class="stat">
                        <span id="events-total">0</span>
                        <span>Total</span>
                    </div>
                    <div class="stat">
                        <span id="events-llm">0</span>
                        <span>LLM Calls</span>
                    </div>
                    <div class="stat">
                        <span id="events-ha">0</span>
                        <span>HA Events</span>
                    </div>
                </div>
            </div>

            <!-- Performance Graphs -->
            <div class="card full-width">
                <div class="card-header">
                    <h3>üìä Performance Metrics</h3>
                    <div class="card-actions">
                        <select id="metrics-time-range" class="filter-select">
                            <option value="15">Last 15 minutes</option>
                            <option value="60" selected>Last hour</option>
                            <option value="360">Last 6 hours</option>
                            <option value="1440">Last 24 hours</option>
                        </select>
                        <button class="btn btn-small" id="refresh-metrics">üîÑ Refresh</button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="metrics-grid">
                        <!-- STT Latency Chart -->
                        <div class="metric-chart">
                            <h4>üé§ STT Latency</h4>
                            <div class="chart-container">
                                <canvas id="stt-latency-chart"></canvas>
                            </div>
                            <div class="metric-stats" id="stt-stats">
                                <span class="stat">P50: <strong>--</strong>ms</span>
                                <span class="stat">P95: <strong>--</strong>ms</span>
                                <span class="stat">Avg: <strong>--</strong>ms</span>
                            </div>
                        </div>
                        <!-- TTS Latency Chart -->
                        <div class="metric-chart">
                            <h4>üîä TTS Latency</h4>
                            <div class="chart-container">
                                <canvas id="tts-latency-chart"></canvas>
                            </div>
                            <div class="metric-stats" id="tts-stats">
                                <span class="stat">P50: <strong>--</strong>ms</span>
                                <span class="stat">P95: <strong>--</strong>ms</span>
                                <span class="stat">Avg: <strong>--</strong>ms</span>
                            </div>
                        </div>
                        <!-- LLM Latency Chart -->
                        <div class="metric-chart">
                            <h4>üß† LLM Latency</h4>
                            <div class="chart-container">
                                <canvas id="llm-latency-chart"></canvas>
                            </div>
                            <div class="metric-stats" id="llm-stats">
                                <span class="stat">P50: <strong>--</strong>ms</span>
                                <span class="stat">P95: <strong>--</strong>ms</span>
                                <span class="stat">Avg: <strong>--</strong>ms</span>
                            </div>
                        </div>
                        <!-- Pipeline Latency Chart -->
                        <div class="metric-chart">
                            <h4>‚ö° Pipeline Total</h4>
                            <div class="chart-container">
                                <canvas id="pipeline-latency-chart"></canvas>
                            </div>
                            <div class="metric-stats" id="pipeline-stats">
                                <span class="stat">P50: <strong>--</strong>ms</span>
                                <span class="stat">P95: <strong>--</strong>ms</span>
                                <span class="stat">Avg: <strong>--</strong>ms</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Log Stream -->
            <div class="card full-width">
                <div class="card-header">
                    <h3>üìú Log Stream</h3>
                    <div class="card-actions">
                        <select id="log-component-filter" class="filter-select">
                            <option value="">All Components</option>
                            <option value="stt">STT</option>
                            <option value="tts">TTS</option>
                            <option value="llm">LLM</option>
                            <option value="memory">Memory</option>
                            <option value="action">Action</option>
                            <option value="homeassistant">Home Assistant</option>
                            <option value="system">System</option>
                        </select>
                        <select id="log-level-filter" class="filter-select">
                            <option value="">All Levels</option>
                            <option value="debug">Debug</option>
                            <option value="info">Info</option>
                            <option value="warn">Warning</option>
                            <option value="error">Error</option>
                        </select>
                        <input type="text" id="log-search" class="filter-search" placeholder="üîç Search logs...">
                        <button class="btn btn-small" id="export-logs">üì§ Export</button>
                        <button class="btn btn-small" id="clear-logs">üóëÔ∏è Clear</button>
                        <label class="toggle-label">
                            <input type="checkbox" id="log-auto-scroll" checked> Auto-scroll
                        </label>
                    </div>
                </div>
                <div class="card-body">
                    <div class="log-stream" id="log-stream">
                        <div class="log-entry info">
                            <span class="log-time">--:--:--</span>
                            <span class="log-level info">INFO</span>
                            <span class="log-component">system</span>
                            <span class="log-message">Connecting to log stream...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- Family Page -->
        <div id="page-family" class="page">
            <div class="page-header">
                <h1>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family Profiles</h1>
                <p>Manage family member profiles and personalized preferences</p>
            </div>

            <!-- Family Stats -->
            <div class="family-stats-bar" id="family-stats">
                <div class="family-stat">
                    <span class="stat-value" id="family-total">-</span>
                    <span class="stat-label">Family Members</span>
                </div>
                <div class="family-stat">
                    <span class="stat-value" id="family-pending">-</span>
                    <span class="stat-label">Pending Updates</span>
                </div>
                <div class="family-stat">
                    <span class="stat-value" id="family-events">-</span>
                    <span class="stat-label">Unprocessed Events</span>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="family-tabs">
                <button class="family-tab active" data-family-tab="members">üë• Members</button>
                <button class="family-tab" data-family-tab="pending">‚è≥ Pending Updates</button>
                <button class="family-tab" data-family-tab="add">‚ûï Add Member</button>
            </div>

            <!-- Members Tab -->
            <div id="family-tab-members" class="family-tab-content active">
                <div class="family-grid" id="family-list">
                    <div class="loading">Loading family profiles...</div>
                </div>
            </div>

            <!-- Pending Updates Tab -->
            <div id="family-tab-pending" class="family-tab-content">
                <div id="pending-updates-list">
                    <div class="loading">Loading pending updates...</div>
                </div>
            </div>

            <!-- Add Member Tab -->
            <div id="family-tab-add" class="family-tab-content">
                <div class="card add-member-card">
                    <div class="card-header">
                        <h3>‚ûï Add New Family Member</h3>
                    </div>
                    <div class="card-body">
                        <form id="add-member-form">
                            <div class="form-group">
                                <label for="new-member-id">Member ID (lowercase, no spaces)</label>
                                <input type="text" id="new-member-id" required pattern="[a-z0-9_]+"
                                    placeholder="e.g., john">
                            </div>
                            <div class="form-group">
                                <label for="new-member-name">Display Name</label>
                                <input type="text" id="new-member-name" required placeholder="e.g., John">
                            </div>
                            <div class="form-group">
                                <label for="new-member-relationship">Relationship</label>
                                <select id="new-member-relationship" required>
                                    <option value="self">Self (Primary User)</option>
                                    <option value="spouse">Spouse/Partner</option>
                                    <option value="child">Child</option>
                                    <option value="parent">Parent</option>
                                    <option value="sibling">Sibling</option>
                                    <option value="extended_family">Extended Family</option>
                                    <option value="guest">Guest</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">Create Profile</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Profile Detail Modal -->
            <div id="profile-modal" class="modal">
                <div class="modal-content profile-modal-content">
                    <div class="modal-header">
                        <h2 id="profile-modal-title">Profile Details</h2>
                        <span class="close-modal">&times;</span>
                    </div>
                    <div class="modal-body" id="profile-modal-body">
                        <!-- Profile details loaded dynamically -->
                    </div>
                </div>
            </div>

            <!-- Diff Preview Modal -->
            <div id="diff-modal" class="modal">
                <div class="modal-content diff-modal-content">
                    <div class="modal-header">
                        <h2 id="diff-modal-title">Profile Update Preview</h2>
                        <span class="close-modal">&times;</span>
                    </div>
                    <div class="modal-body" id="diff-modal-body">
                        <!-- Diff details loaded dynamically -->
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-success" id="diff-approve-btn">‚úì Approve Changes</button>
                        <button class="btn btn-danger" id="diff-reject-btn">‚úó Reject Changes</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Entities Page (Home Assistant Dashboard) -->
        <div id="page-entities" class="page">
            <div class="page-header">
                <h1>üè† What Barnabee Knows</h1>
                <p>Barnabee's understanding of your Home Assistant environment</p>
            </div>

            <!-- Discovery Status Banner -->
            <div class="card ha-status-banner">
                <div id="ha-connection-status">
                    <div class="ha-status-disconnected">
                        <span class="status-indicator disconnected"></span>
                        <span class="status-text">Checking connection...</span>
                    </div>
                </div>
                <div id="ha-snapshot-summary"></div>
            </div>

            <!-- HA Tab Navigation -->
            <div class="ha-tabs">
                <button class="ha-tab-btn active" data-ha-tab="overview">üìä Overview</button>
                <button class="ha-tab-btn" data-ha-tab="entities">üí° Entities</button>
                <button class="ha-tab-btn" data-ha-tab="areas">üó∫Ô∏è Areas</button>
                <button class="ha-tab-btn" data-ha-tab="devices">üì± Devices</button>
                <button class="ha-tab-btn" data-ha-tab="activity">üìã Activity Log</button>
                <button class="ha-tab-btn" data-ha-tab="analysis">üîç Log Analysis</button>
            </div>

            <!-- Overview Tab (NEW) -->
            <div id="ha-tab-overview" class="ha-tab-content active">
                <div class="ha-overview-grid">
                    <!-- Discovery Status -->
                    <div class="card">
                        <div class="card-header">
                            <h3>üîÑ Discovery Status</h3>
                        </div>
                        <div class="card-body" id="ha-discovery-status">
                            <div class="discovery-stats">
                                <div class="discovery-stat">
                                    <span class="stat-label">Last Sync</span>
                                    <span class="stat-value" id="ha-last-sync">Never</span>
                                </div>
                                <div class="discovery-stat">
                                    <span class="stat-label">Entities Known</span>
                                    <span class="stat-value" id="ha-entity-count">0</span>
                                </div>
                                <div class="discovery-stat">
                                    <span class="stat-label">Areas Mapped</span>
                                    <span class="stat-value" id="ha-area-count">0</span>
                                </div>
                                <div class="discovery-stat">
                                    <span class="stat-label">Devices Found</span>
                                    <span class="stat-value" id="ha-device-count">0</span>
                                </div>
                            </div>
                            <button class="btn" id="ha-sync-now">üîÑ Sync Now</button>
                        </div>
                    </div>

                    <!-- Domain Breakdown -->
                    <div class="card">
                        <div class="card-header">
                            <h3>üìä What Barnabee Can Control</h3>
                        </div>
                        <div class="card-body">
                            <div class="domain-counts" id="ha-domain-counts">
                                <p class="text-muted">Connect to Home Assistant to see domain statistics</p>
                            </div>
                        </div>
                    </div>

                    <!-- Recent HA Activity -->
                    <div class="card full-width">
                        <div class="card-header">
                            <h3>üìã Recent Barnabee Actions</h3>
                        </div>
                        <div class="card-body">
                            <div class="ha-recent-activity" id="ha-recent-activity">
                                <p class="text-muted">No recent Home Assistant activity</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Entities Tab -->
            <div id="ha-tab-entities" class="ha-tab-content">
                <div class="entities-toolbar">
                    <input type="text" id="entity-search" class="form-control"
                        placeholder="üîç Search entities Barnabee knows about...">
                    <select id="entity-type-filter" class="filter-select">
                        <option value="">All Types</option>
                        <option value="light">Lights</option>
                        <option value="switch">Switches</option>
                        <option value="climate">Climate</option>
                        <option value="sensor">Sensors</option>
                        <option value="binary_sensor">Binary Sensors</option>
                        <option value="media_player">Media Players</option>
                        <option value="cover">Covers</option>
                        <option value="fan">Fans</option>
                        <option value="lock">Locks</option>
                    </select>
                    <select id="entity-area-filter" class="filter-select">
                        <option value="">All Areas</option>
                    </select>
                </div>

                <div class="entities-grid" id="entities-list">
                    <div class="empty-state">
                        <p class="text-muted">Loading entities...</p>
                    </div>
                </div>
            </div>

            <!-- Areas Tab -->
            <div id="ha-tab-areas" class="ha-tab-content">
                <div class="areas-grid" id="ha-areas-list">
                    <div class="empty-state">
                        <p class="text-muted">Loading areas...</p>
                    </div>
                </div>
            </div>

            <!-- Devices Tab -->
            <div id="ha-tab-devices" class="ha-tab-content">
                <div class="devices-grid" id="ha-devices-list">
                    <div class="empty-state">
                        <p class="text-muted">Loading devices...</p>
                    </div>
                </div>
            </div>

            <!-- Activity Log Tab (replaces Logs/Automations) -->
            <div id="ha-tab-activity" class="ha-tab-content">
                <div class="ha-activity-header">
                    <h3>Barnabee's Home Assistant Activity</h3>
                    <p class="text-muted">All actions Barnabee has taken through Home Assistant</p>
                </div>
                <div class="ha-activity-log" id="ha-activity-log">
                    <div class="empty-state">
                        <p class="text-muted">No activity yet. Talk to Barnabee to control your home!</p>
                    </div>
                </div>
            </div>

            <!-- Log Analysis Tab (AI-powered) -->
            <div id="ha-tab-analysis" class="ha-tab-content">
                <div class="ha-analysis-header">
                    <h3>ü§ñ AI Log Analysis</h3>
                    <p class="text-muted">Let AI identify important issues in your Home Assistant logs</p>
                    <div class="ha-analysis-actions">
                        <button class="btn" id="run-log-analysis">üîç Analyze Logs</button>
                        <span class="analysis-status" id="analysis-status"></span>
                    </div>
                </div>
                <div class="ha-analysis-results" id="ha-analysis-results">
                    <div class="empty-state">
                        <p class="text-muted">Click "Analyze Logs" to scan for issues</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Self-Improve Page -->
        <div id="page-self-improve" class="page">
            <!-- Action Required Banner (sticky at top) -->
            <div id="si-action-required" class="si-action-required hidden">
                <div class="action-banner">
                    <span class="action-icon">‚ö†Ô∏è</span>
                    <span class="action-title" id="action-required-title">Action Required</span>
                    <span class="action-description" id="action-required-description"></span>
                    <div class="action-buttons" id="action-required-buttons"></div>
                </div>
            </div>

            <!-- Progress Timeline -->
            <div class="si-timeline-container" id="si-timeline-container">
                <div class="si-timeline" id="si-timeline">
                    <div class="timeline-step" data-step="started">
                        <div class="step-dot"></div>
                        <div class="step-label">Started</div>
                    </div>
                    <div class="timeline-connector"></div>
                    <div class="timeline-step" data-step="diagnosing">
                        <div class="step-dot"></div>
                        <div class="step-label">Diagnosing</div>
                    </div>
                    <div class="timeline-connector"></div>
                    <div class="timeline-step" data-step="plan_approval">
                        <div class="step-dot"></div>
                        <div class="step-label">Plan Review</div>
                    </div>
                    <div class="timeline-connector"></div>
                    <div class="timeline-step" data-step="implementing">
                        <div class="step-dot"></div>
                        <div class="step-label">Implementing</div>
                    </div>
                    <div class="timeline-connector"></div>
                    <div class="timeline-step" data-step="testing">
                        <div class="step-dot"></div>
                        <div class="step-label">Testing</div>
                    </div>
                    <div class="timeline-connector"></div>
                    <div class="timeline-step" data-step="commit_approval">
                        <div class="step-dot"></div>
                        <div class="step-label">Commit</div>
                    </div>
                    <div class="timeline-connector"></div>
                    <div class="timeline-step" data-step="completed">
                        <div class="step-dot"></div>
                        <div class="step-label">Done</div>
                    </div>
                </div>
            </div>

            <div class="page-header">
                <h1>üîß Self-Improvement Agent</h1>
                <p>AI-powered code improvements with human approval gates</p>
            </div>

            <div class="self-improvement-panel">
                <!-- Top Bar: Status + New Request -->
                <div class="si-top-bar">
                    <div class="si-status" id="si-status-section">
                        <span class="status-dot" id="si-status-dot"></span>
                        <span id="si-status-text">Ready</span>
                        <span id="si-request-text" class="si-request-text"></span>
                    </div>
                    <div class="si-actions">
                        <button id="si-stop-btn" class="btn btn-danger btn-sm hidden">‚èπ Stop</button>
                        <button class="btn btn-primary btn-sm" id="new-improvement-btn">+ New Request</button>
                    </div>
                </div>

                <!-- CLI Output - Main Focus -->
                <div id="si-cli-section" class="si-cli-main">
                    <div class="cli-header">
                        <div class="cli-title">
                            <span>üíª Claude Code CLI</span>
                            <span id="si-cli-status" class="si-cli-status"></span>
                        </div>
                        <div class="cli-controls">
                            <label class="toggle-label">
                                <input type="checkbox" id="cli-auto-scroll" checked>
                                Auto-scroll
                            </label>
                            <button class="btn btn-sm" onclick="SelfImprovement.clearCLI()">Clear</button>
                            <button class="btn btn-sm" onclick="SelfImprovement.copyCLI()">Copy</button>
                        </div>
                    </div>
                    <div class="cli-terminal" id="cli-terminal">
                        <pre
                            id="si-cli-output"><span class="cli-empty">No active session. Click "+ New Request" to start.</span></pre>
                    </div>
                </div>
            </div>

            <!-- Plan Approval Modal -->
            <div id="si-plan-modal" class="modal" style="display: none;">
                <div class="modal-content modal-large">
                    <div class="modal-header">
                        <h3>üìã Proposed Plan</h3>
                        <div id="si-safety-score" class="si-safety-score"></div>
                    </div>
                    <div class="modal-body">
                        <div id="si-plan-content" class="si-plan-content"></div>
                        <div class="si-plan-actions">
                            <input type="text" id="si-plan-feedback"
                                placeholder="Optional: Add guidance or conditions...">
                            <div class="si-plan-buttons">
                                <button id="si-reject-plan" class="btn btn-secondary">‚úó Reject & Revise</button>
                                <button id="si-approve-plan" class="btn btn-success">‚úì Approve & Proceed</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Commit Approval Modal -->
            <div id="si-commit-modal" class="modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>üìù Changes Ready</h3>
                        <button class="btn btn-small modal-close-btn"
                            onclick="document.getElementById('si-commit-modal').style.display='none'">‚úï</button>
                    </div>
                    <div class="modal-body">
                        <div id="si-changes-summary" class="si-changes-summary"></div>
                        <div class="si-commit-actions">
                            <button id="si-reject-changes" class="btn btn-danger">‚úó Discard Changes</button>
                            <button id="si-approve-changes" class="btn btn-success">‚úì Commit Changes</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- New Improvement Modal -->
            <div id="si-modal" class="modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Request Improvement</h3>
                        <button class="btn btn-small modal-close-btn" id="si-modal-close">‚úï</button>
                    </div>
                    <div class="modal-body">
                        <textarea id="si-improvement-request"
                            placeholder="Describe the issue or improvement...&#10;&#10;Examples:&#10;- 'The last voice command didn't work, look into it'&#10;- 'Add better error messages to action agent'&#10;- 'Optimize the STT pipeline latency'"
                            rows="6"></textarea>
                        <div class="model-select">
                            <label>
                                <input type="radio" name="si-model" value="opusplan" checked>
                                üîÑ Auto (opusplan) - Opus for planning, Sonnet for implementation
                            </label>
                            <label>
                                <input type="radio" name="si-model" value="opus">
                                üß† Opus 4.5 - Best reasoning (slower, uses more quota)
                            </label>
                            <label>
                                <input type="radio" name="si-model" value="sonnet">
                                ‚ö° Sonnet 4.5 - Fast and capable
                            </label>
                        </div>
                        <div class="modal-actions">
                            <button id="si-cancel" class="btn btn-secondary">Cancel</button>
                            <button id="si-submit" class="btn btn-primary">
                                Start Investigation
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configuration Page -->
        <div id="page-config" class="page">
            <div class="page-header">
                <h1>‚öôÔ∏è Configuration</h1>
                <p>Manage LLM providers and system configuration</p>
            </div>

            <div class="config-layout">
                <div class="config-sidebar">
                    <h4>Categories</h4>
                    <ul class="config-nav">
                        <li class="active" data-config="providers">ü§ñ LLM Providers</li>
                        <li data-config="models">üß† Model Selection</li>
                        <li data-config="agents">ü§ñ AI Agents</li>
                        <li data-config="homeassistant">üè† Home Assistant</li>
                        <li data-config="testing">üß™ Testing & Dev</li>
                    </ul>
                </div>
                <div class="config-content">
                    <!-- LLM Providers Section -->
                    <div id="config-providers" class="config-section active">
                        <h3>ü§ñ LLM Provider Configuration</h3>
                        <p class="section-desc">Configure API keys for LLM providers. Keys are encrypted and stored
                            securely.</p>

                        <div class="provider-status-bar">
                            <span id="providers-configured">0</span> configured &nbsp;|&nbsp;
                            <span id="providers-enabled">0</span> enabled
                            <button class="btn btn-small" id="refresh-providers" style="margin-left: 16px;">üîÑ
                                Refresh</button>
                        </div>

                        <div class="providers-grid" id="providers-list">
                            <!-- Populated dynamically -->
                            <div class="loading-spinner">Loading providers...</div>
                        </div>
                    </div>

                    <!-- Provider Setup Modal -->
                    <div id="provider-modal" class="modal" style="display: none;">
                        <div class="modal-content modal-large">
                            <div class="modal-header">
                                <h3 id="provider-modal-title">Configure Provider</h3>
                                <button class="btn btn-small" id="close-provider-modal">‚úï</button>
                            </div>
                            <div class="modal-body">
                                <div class="provider-setup-grid">
                                    <div class="provider-instructions">
                                        <h4>üìã Setup Instructions</h4>
                                        <ol id="provider-setup-steps">
                                            <!-- Populated dynamically -->
                                        </ol>
                                        <div class="provider-links">
                                            <a id="provider-docs-link" href="#" target="_blank" class="btn btn-small">üìñ
                                                Documentation</a>
                                            <a id="provider-key-link" href="#" target="_blank"
                                                class="btn btn-small btn-primary">üîë Get API Key</a>
                                        </div>
                                    </div>
                                    <div class="provider-form">
                                        <h4>üîê Credentials</h4>
                                        <form id="provider-setup-form">
                                            <input type="hidden" id="provider-type">
                                            <div id="provider-secret-fields">
                                                <!-- Secret fields populated dynamically -->
                                            </div>
                                            <div id="provider-config-fields">
                                                <!-- Config fields populated dynamically -->
                                            </div>
                                            <div class="form-actions">
                                                <button type="button" class="btn" id="test-provider-btn">üß™ Test
                                                    Connection</button>
                                                <button type="submit" class="btn btn-primary">üíæ Save & Enable</button>
                                            </div>
                                        </form>
                                        <div id="provider-test-result" class="test-result" style="display: none;"></div>
                                    </div>
                                </div>
                                <div class="provider-pricing" id="provider-pricing">
                                    <!-- Pricing notes -->
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- Model Selection Section -->
                    <div id="config-models" class="config-section">
                        <h3>üß† Model Selection</h3>
                        <p class="section-desc">Each agent uses one model configured in <code>config/llm.yaml</code>.
                            Edit the config file to change models.</p>

                        <div class="agent-models-list" id="agent-models-list">
                            <div class="loading-spinner">Loading agent models...</div>
                        </div>
                    </div>

                    <!-- AI Agents Section -->
                    <div id="config-agents" class="config-section">
                        <h3>ü§ñ AI Agents</h3>
                        <p class="section-desc">Manage and configure AI agent settings</p>

                        <div class="agents-container">
                            <!-- Self-Improvement Agent -->
                            <div class="agent-card">
                                <div class="agent-card-header">
                                    <h4>üîß Self-Improvement Agent</h4>
                                    <p class="agent-description">AI-powered code improvements with human approval gates</p>
                                </div>
                                <div class="agent-card-body">
                                    <div class="agent-setting">
                                        <label>Model Selection:</label>
                                        <div class="model-toggle-group">
                                            <label class="toggle-option">
                                                <input type="radio" name="si-model-config" value="auto" id="si-model-auto-config">
                                                <span>üîÑ Auto</span>
                                                <small>Opus for planning, Sonnet for implementation</small>
                                            </label>
                                            <label class="toggle-option">
                                                <input type="radio" name="si-model-config" value="opus" id="si-model-opus-config">
                                                <span>üß† Opus 4.5</span>
                                                <small>Best reasoning (slower, uses more quota)</small>
                                            </label>
                                            <label class="toggle-option">
                                                <input type="radio" name="si-model-config" value="sonnet" id="si-model-sonnet-config">
                                                <span>‚ö° Sonnet 4.5</span>
                                                <small>Fast and capable</small>
                                            </label>
                                        </div>
                                        <button class="btn btn-primary btn-sm" id="save-si-model-config">Save</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Model Finder Agent -->
                            <div class="agent-card">
                                <div class="agent-card-header">
                                    <h4>üîç Model Finder Agent</h4>
                                    <p class="agent-description">Analyze all available models and recommend best for each agent</p>
                                </div>
                                <div class="agent-card-body">
                                    <div class="agent-setting">
                                        <label>Analysis Preferences:</label>
                                        <div class="preference-group">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="mf-free-only-config">
                                                <span>Free models only</span>
                                            </label>
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="mf-azure-free-config" checked>
                                                <span>Azure is free (150 credits/month)</span>
                                            </label>
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="mf-prefer-speed-config" checked>
                                                <span>Prefer speed</span>
                                            </label>
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="mf-prefer-quality-config">
                                                <span>Prefer quality</span>
                                            </label>
                                        </div>
                                        <div class="agent-actions">
                                            <button class="btn btn-primary" id="analyze-models-btn-config">üîç Analyze Models</button>
                                        </div>
                                    </div>
                                    <div id="model-finder-results-config" class="agent-results" style="display: none;">
                                        <h4>Recommendations</h4>
                                        <div id="model-recommendations-list-config"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Feature Agent -->
                            <div class="agent-card">
                                <div class="agent-card-header">
                                    <h4>üí° Feature Agent</h4>
                                    <p class="agent-description">Analyze usage patterns and recommend new features</p>
                                </div>
                                <div class="agent-card-body">
                                    <div class="agent-setting">
                                        <p class="agent-note">Runs automatically once per day. You can also trigger manual analysis.</p>
                                        <div class="agent-actions">
                                            <button class="btn btn-primary" id="analyze-features-btn-config">üí° Analyze Features</button>
                                        </div>
                                    </div>
                                    <div id="feature-agent-results-config" class="agent-results" style="display: none;">
                                        <h4>Feature Recommendations</h4>
                                        <div id="feature-recommendations-list-config"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="config-homeassistant" class="config-section">
                        <h3>üè† Home Assistant</h3>
                        <p class="section-desc">Configure connection to your Home Assistant instance.</p>

                        <!-- Connection Status -->
                        <div class="ha-config-status" id="ha-config-connection-status">
                            <div class="ha-status-disconnected">
                                <span class="status-indicator disconnected"></span>
                                <span class="status-text">Not Configured</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Home Assistant URL</label>
                            <input type="text" id="ha-url-input" class="form-control"
                                placeholder="http://192.168.1.100:8123">
                            <small class="form-text">The URL of your Home Assistant instance (e.g.,
                                http://192.168.86.50:8123)</small>
                        </div>
                        <div class="form-group">
                            <label>Long-Lived Access Token</label>
                            <input type="password" id="ha-token-input" class="form-control"
                                placeholder="Paste your token here...">
                            <small class="form-text">Generate in Home Assistant: Profile ‚Üí Long-Lived Access
                                Tokens</small>
                        </div>
                        <div class="form-actions">
                            <button class="btn" id="test-ha-connection">üîó Test Connection</button>
                            <button class="btn btn-primary" id="save-ha-config">üíæ Save</button>
                        </div>
                        <div id="ha-test-result" class="test-result" style="display: none;"></div>

                        <hr>

                        <h4>üìã Setup Instructions</h4>
                        <ol class="setup-steps">
                            <li>Open your Home Assistant instance in a browser</li>
                            <li>Click your <strong>Profile</strong> (your name in the bottom left)</li>
                            <li>Scroll down to <strong>Long-Lived Access Tokens</strong></li>
                            <li>Click <strong>Create Token</strong></li>
                            <li>Name it "BarnabeeNet" and click <strong>OK</strong></li>
                            <li>Copy the token and paste it in the field above</li>
                            <li>Click <strong>Test Connection</strong> to verify</li>
                            <li>Click <strong>Save</strong> to store the configuration</li>
                        </ol>
                    </div>

                    <!-- Testing & Development Section -->
                    <div id="config-testing" class="config-section">
                        <h3>üß™ Testing & Development</h3>
                        <p class="section-desc">Tools for testing during development. Use these to populate the system with mock data or reset for production.</p>

                        <!-- Testing Status -->
                        <div class="testing-status-card" id="testing-status">
                            <div class="status-grid">
                                <div class="status-item">
                                    <span class="status-label">Memory Storage</span>
                                    <span class="status-value" id="testing-memory-status">--</span>
                                </div>
                                <div class="status-item">
                                    <span class="status-label">Profile Service</span>
                                    <span class="status-value" id="testing-profile-status">--</span>
                                </div>
                                <div class="status-item">
                                    <span class="status-label">Total Memories</span>
                                    <span class="status-value" id="testing-memory-count">--</span>
                                </div>
                                <div class="status-item">
                                    <span class="status-label">Family Profiles</span>
                                    <span class="status-value" id="testing-profile-count">--</span>
                                </div>
                            </div>
                        </div>

                        <hr>

                        <!-- Mock Data Generation -->
                        <div class="testing-section">
                            <h4>üìù Generate Mock Data</h4>
                            <p class="text-muted">Create sample family profiles, memories, and conversations for testing.</p>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="mock-include-family" checked>
                                    <span>Include family profiles (6 members)</span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="mock-include-memories" checked>
                                    <span>Include memories (facts about family)</span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="mock-include-conversations" checked>
                                    <span>Include conversation history</span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label>Days of history to generate:</label>
                                <input type="number" id="mock-days" class="form-control" value="7" min="1" max="30" style="width: 100px;">
                            </div>
                            <button class="btn btn-primary" id="generate-mock-data-btn">üìù Generate Mock Data</button>
                            <div id="mock-data-result" class="test-result" style="display: none;"></div>
                        </div>

                        <hr>

                        <!-- Clear Data -->
                        <div class="testing-section">
                            <h4>üóëÔ∏è Clear All Data</h4>
                            <p class="text-muted warning-text">‚ö†Ô∏è This will permanently delete data. Use when preparing for production.</p>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="clear-memories" checked>
                                    <span>Clear all memories</span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="clear-conversations" checked>
                                    <span>Clear conversation contexts</span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="clear-family-profiles" checked>
                                    <span>Clear family profiles</span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="clear-audit-log">
                                    <span>Clear audit log (production reset only)</span>
                                </label>
                            </div>
                            <button class="btn btn-danger" id="clear-all-data-btn">üóëÔ∏è Clear All Data</button>
                            <div id="clear-data-result" class="test-result" style="display: none;"></div>
                        </div>

                        <hr>

                        <!-- Delete Mock Data Only -->
                        <div class="testing-section">
                            <h4>üßπ Delete Mock Data Only</h4>
                            <p class="text-muted">Remove only data tagged as mock data, preserving real user data.</p>
                            <button class="btn btn-secondary" id="delete-mock-data-btn">üßπ Delete Mock Data Only</button>
                            <div id="delete-mock-result" class="test-result" style="display: none;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Floating Chat Button -->
    <button id="floating-chat-btn" class="floating-chat-btn" title="Chat with Barnabee">
        üêù
    </button>

    <!-- Floating Chat Popup -->
    <div id="floating-chat-popup" class="floating-chat-popup">
        <div class="floating-chat-header">
            <div class="floating-chat-title">
                <span class="floating-chat-avatar">üêù</span>
                <span>Chat with Barnabee</span>
            </div>
            <button id="floating-chat-close" class="floating-chat-close">&times;</button>
        </div>
        <div class="floating-chat-messages" id="floating-chat-messages">
            <div class="floating-chat-welcome">
                <p>Hi! I'm Barnabee. How can I help?</p>
            </div>
        </div>
        <div class="floating-chat-input-container">
            <input type="text" id="floating-chat-input" class="floating-chat-input" placeholder="Type a message..."
                autocomplete="off">
            <button id="floating-chat-send" class="floating-chat-send">‚û§</button>
        </div>
    </div>

    <script src="/static/app.js?v=3"></script>
</body>

</html>
