<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BarnabeeNet Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <nav class="navbar">
        <div class="nav-brand">
            <span class="logo">üêù</span>
            <span class="brand-name">BarnabeeNet Dashboard</span>
        </div>
        <div class="nav-links">
            <a href="#" class="nav-link active" data-page="dashboard">Dashboard</a>
            <a href="#" class="nav-link" data-page="chat">Chat</a>
            <a href="#" class="nav-link" data-page="memory">Memory</a>
            <a href="#" class="nav-link" data-page="logs">Logs</a>
            <a href="#" class="nav-link" data-page="prompts">Prompts</a>
            <a href="#" class="nav-link" data-page="setup">Setup & Test</a>
            <a href="#" class="nav-link" data-page="family">Family</a>
            <a href="#" class="nav-link" data-page="entities">Entities</a>
            <a href="#" class="nav-link" data-page="config">Configuration</a>
        </div>
        <div class="nav-status">
            <span class="status-indicator" id="ws-status"></span>
            <span id="current-time"></span>
        </div>
    </nav>

    <main class="main-content">
        <!-- Dashboard Page -->
        <div id="page-dashboard" class="page active">
            <div class="page-header">
                <h1>BarnabeeNet Dashboard</h1>
                <p>Monitor your smart home AI system status and activity</p>
            </div>

            <div class="dashboard-grid">
                <!-- System Status -->
                <div class="card">
                    <div class="card-header">
                        <h3>üñ•Ô∏è System Status</h3>
                    </div>
                    <div class="card-body" id="system-status">
                        <div class="status-row">
                            <span class="status-label">Status:</span>
                            <span class="status-value status-loading">Loading...</span>
                        </div>
                    </div>
                </div>

                <!-- Services Health -->
                <div class="card">
                    <div class="card-header">
                        <h3>üíö Services</h3>
                    </div>
                    <div class="card-body" id="services-health">
                        <div class="status-row">
                            <span class="status-label">Loading...</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="card">
                    <div class="card-header">
                        <h3>üìä Statistics</h3>
                    </div>
                    <div class="card-body" id="quick-stats">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="stat-value" id="stat-requests">-</span>
                                <span class="stat-label">Requests</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value" id="stat-signals">-</span>
                                <span class="stat-label">Signals</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value" id="stat-memories">-</span>
                                <span class="stat-label">Memories</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value" id="stat-actions">-</span>
                                <span class="stat-label">Actions</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Errors -->
                <div class="card">
                    <div class="card-header">
                        <h3>‚ö†Ô∏è Recent Errors</h3>
                    </div>
                    <div class="card-body" id="recent-errors">
                        <p class="text-muted">No recent errors</p>
                    </div>
                </div>
            </div>

            <!-- Activity Feed -->
            <div class="card full-width">
                <div class="card-header">
                    <h3>üì° Live Activity Feed</h3>
                    <div class="card-actions">
                        <select id="activity-filter" class="filter-select">
                            <option value="">All Types</option>
                            <option value="request_start">Requests</option>
                            <option value="stt">STT</option>
                            <option value="meta_classify">Classification</option>
                            <option value="llm_request">LLM Calls</option>
                            <option value="ha_service_call">HA Actions</option>
                            <option value="memory">Memory</option>
                            <option value="tts">TTS</option>
                            <option value="error">Errors</option>
                        </select>
                        <button class="btn btn-small" id="clear-activity">Clear</button>
                        <label class="toggle-label">
                            <input type="checkbox" id="auto-scroll" checked>
                            Auto-scroll
                        </label>
                    </div>
                </div>
                <div class="card-body">
                    <div class="activity-feed" id="activity-feed">
                        <div class="activity-item info">
                            <span class="activity-time">--:--:--</span>
                            <span class="activity-badge system">System</span>
                            <span class="activity-message">Connecting to activity stream...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Request Traces -->
            <div class="card full-width">
                <div class="card-header">
                    <h3>üîç Recent Request Traces</h3>
                    <div class="card-actions">
                        <button class="btn btn-small" id="refresh-traces">üîÑ Refresh</button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="traces-list" id="traces-list">
                        <p class="text-muted">Loading traces...</p>
                    </div>
                </div>
            </div>

            <!-- Trace Detail Modal -->
            <div id="trace-modal" class="modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>üî¨ Request Trace Detail</h3>
                        <button class="btn btn-small" id="close-modal">‚úï</button>
                    </div>
                    <div class="modal-body" id="trace-detail">
                        <!-- Populated dynamically -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat Page - Talk to Barnabee -->
        <div id="page-chat" class="page">
            <div class="chat-container">
                <!-- Chat Header -->
                <div class="chat-header">
                    <div class="chat-avatar">üêù</div>
                    <div class="chat-info">
                        <h2>Barnabee</h2>
                        <span class="chat-status" id="chat-status">Ready to chat</span>
                    </div>
                    <div class="chat-actions">
                        <button id="chat-clear-btn" class="btn btn-secondary" title="Clear conversation">
                            üóëÔ∏è Clear
                        </button>
                    </div>
                </div>

                <!-- Chat Messages Area -->
                <div class="chat-messages" id="chat-messages">
                    <div class="chat-welcome">
                        <div class="welcome-avatar">üêù</div>
                        <h3>Hello! I'm Barnabee</h3>
                        <p>Your friendly home assistant. I can help you with:</p>
                        <div class="welcome-suggestions">
                            <button class="suggestion-chip" data-suggestion="What time is it?">üïê What time is
                                it?</button>
                            <button class="suggestion-chip" data-suggestion="What's the weather like?">üå§Ô∏è
                                Weather</button>
                            <button class="suggestion-chip" data-suggestion="Turn on the living room lights">üí° Control
                                lights</button>
                            <button class="suggestion-chip" data-suggestion="Tell me a joke">üòÑ Tell me a joke</button>
                            <button class="suggestion-chip" data-suggestion="What can you do?">‚ùì What can you
                                do?</button>
                        </div>
                    </div>
                </div>

                <!-- Chat Input -->
                <div class="chat-input-container">
                    <div class="chat-input-wrapper">
                        <button id="chat-mic-btn" class="chat-mic-btn" title="Click to record voice">
                            <span class="mic-icon">üé§</span>
                        </button>
                        <input type="text" id="chat-input" class="chat-input" placeholder="Type or click üé§ to speak..."
                            autocomplete="off">
                        <button id="chat-send-btn" class="chat-send-btn" title="Send message">
                            <span class="send-icon">‚û§</span>
                        </button>
                    </div>
                    <div class="chat-voice-indicator" id="chat-voice-indicator">
                        <div class="voice-wave">
                            <span></span><span></span><span></span><span></span><span></span>
                        </div>
                        <span class="voice-status">Listening...</span>
                    </div>
                    <div class="chat-input-hint">
                        Press <kbd>Enter</kbd> to send ‚Ä¢ Click <kbd>üé§</kbd> to record ‚Ä¢ Barnabee responds with
                        personality!
                    </div>
                </div>
            </div>
        </div>

        <!-- Memory Page - Barnabee's Memories -->
        <div id="page-memory" class="page">
            <div class="page-header">
                <h1>üß† Barnabee's Memory</h1>
                <p>View and manage what Barnabee knows about your household</p>
            </div>

            <!-- Memory Stats Cards -->
            <div class="memory-stats-row">
                <div class="stat-card">
                    <div class="stat-icon">üìö</div>
                    <div class="stat-value" id="memory-total">0</div>
                    <div class="stat-label">Total Memories</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üÜï</div>
                    <div class="stat-value" id="memory-24h">0</div>
                    <div class="stat-label">Last 24 Hours</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìÖ</div>
                    <div class="stat-value" id="memory-7d">0</div>
                    <div class="stat-label">Last 7 Days</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üíæ</div>
                    <div class="stat-value" id="memory-backend">-</div>
                    <div class="stat-label">Storage Backend</div>
                </div>
            </div>

            <!-- Memory Tabs -->
            <div class="memory-tabs">
                <button class="memory-tab active" data-tab="all">üìã All Memories</button>
                <button class="memory-tab" data-tab="semantic">üí° Facts & Knowledge</button>
                <button class="memory-tab" data-tab="episodic">üìù Conversations</button>
                <button class="memory-tab" data-tab="diary">üìñ Diary</button>
                <button class="memory-tab" data-tab="search">üîç Search</button>
                <button class="memory-tab" data-tab="add">‚ûï Add Memory</button>
            </div>

            <!-- Tab Content: All Memories -->
            <div class="memory-tab-content active" id="tab-all">
                <div class="memory-filters">
                    <select id="memory-type-filter" class="form-control">
                        <option value="">All Types</option>
                        <option value="semantic">Semantic (Facts)</option>
                        <option value="episodic">Episodic (Events)</option>
                        <option value="procedural">Procedural (Routines)</option>
                    </select>
                    <select id="memory-participant-filter" class="form-control">
                        <option value="">All Participants</option>
                    </select>
                    <button id="memory-refresh-btn" class="btn btn-secondary">üîÑ Refresh</button>
                </div>
                <div class="memory-list" id="memory-list">
                    <div class="loading">Loading memories...</div>
                </div>
                <div class="memory-pagination" id="memory-pagination"></div>
            </div>

            <!-- Tab Content: Facts & Knowledge -->
            <div class="memory-tab-content" id="tab-semantic">
                <div class="memory-category-intro">
                    <h3>üí° Semantic Memories</h3>
                    <p>Long-term facts about the household: preferences, relationships, and general knowledge.</p>
                </div>
                <div class="memory-list" id="semantic-list">
                    <div class="loading">Loading facts...</div>
                </div>
            </div>

            <!-- Tab Content: Conversations -->
            <div class="memory-tab-content" id="tab-episodic">
                <div class="memory-category-intro">
                    <h3>üìù Episodic Memories</h3>
                    <p>Specific events and conversations from interactions.</p>
                </div>
                <div class="memory-list" id="episodic-list">
                    <div class="loading">Loading events...</div>
                </div>
            </div>

            <!-- Tab Content: Diary -->
            <div class="memory-tab-content" id="tab-diary">
                <div class="memory-category-intro">
                    <h3>üìñ Daily Diary</h3>
                    <p>Barnabee's daily journal entries summarizing household activity.</p>
                </div>
                <div class="diary-entries" id="diary-entries">
                    <div class="loading">Loading diary...</div>
                </div>
            </div>

            <!-- Tab Content: Search -->
            <div class="memory-tab-content" id="tab-search">
                <div class="memory-search-form">
                    <h3>üîç Search Memories</h3>
                    <p>Find specific memories using semantic search.</p>
                    <div class="search-input-row">
                        <input type="text" id="memory-search-input" class="form-control"
                            placeholder="What is Thom's favorite color?" />
                        <button id="memory-search-btn" class="btn btn-primary">Search</button>
                    </div>
                </div>
                <div class="memory-search-results" id="memory-search-results">
                    <p class="search-hint">Enter a question or topic to search Barnabee's memories.</p>
                </div>
            </div>

            <!-- Tab Content: Add Memory -->
            <div class="memory-tab-content" id="tab-add">
                <div class="memory-add-form">
                    <h3>‚ûï Add New Memory</h3>
                    <p>Manually store information for Barnabee to remember.</p>
                    <div class="form-group">
                        <label>Memory Content</label>
                        <textarea id="add-memory-content" class="form-control" rows="3"
                            placeholder="e.g., Thom's favorite color is blue"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Type</label>
                            <select id="add-memory-type" class="form-control">
                                <option value="semantic">Semantic (Fact/Preference)</option>
                                <option value="episodic">Episodic (Event)</option>
                                <option value="procedural">Procedural (Routine)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Importance (0-1)</label>
                            <input type="number" id="add-memory-importance" class="form-control" value="0.5" min="0"
                                max="1" step="0.1" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Participants (comma-separated)</label>
                        <input type="text" id="add-memory-participants" class="form-control"
                            placeholder="e.g., Thom, Heidi" />
                    </div>
                    <div class="form-group">
                        <label>Tags (comma-separated)</label>
                        <input type="text" id="add-memory-tags" class="form-control"
                            placeholder="e.g., preference, color" />
                    </div>
                    <button id="add-memory-btn" class="btn btn-primary">üíæ Store Memory</button>
                </div>
            </div>
        </div>

        <!-- Logs Page -->
        <div id="page-logs" class="page">
            <div class="page-header">
                <h1>üìã System Logs</h1>
                <p>Real-time log stream with filtering and performance graphs</p>
            </div>

            <!-- Live Activity Stats Bar -->
            <div class="card full-width" style="margin-bottom: 20px;">
                <div class="activity-stats-bar">
                    <div class="stat">
                        <span id="events-per-sec">0.0</span>
                        <span>Events/sec</span>
                    </div>
                    <div class="stat">
                        <span id="events-total">0</span>
                        <span>Total</span>
                    </div>
                    <div class="stat">
                        <span id="events-llm">0</span>
                        <span>LLM Calls</span>
                    </div>
                    <div class="stat">
                        <span id="events-ha">0</span>
                        <span>HA Events</span>
                    </div>
                </div>
            </div>

            <!-- Performance Graphs -->
            <div class="card full-width">
                <div class="card-header">
                    <h3>üìä Performance Metrics</h3>
                    <div class="card-actions">
                        <select id="metrics-time-range" class="filter-select">
                            <option value="15">Last 15 minutes</option>
                            <option value="60" selected>Last hour</option>
                            <option value="360">Last 6 hours</option>
                            <option value="1440">Last 24 hours</option>
                        </select>
                        <button class="btn btn-small" id="refresh-metrics">üîÑ Refresh</button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="metrics-grid">
                        <!-- STT Latency Chart -->
                        <div class="metric-chart">
                            <h4>üé§ STT Latency</h4>
                            <div class="chart-container">
                                <canvas id="stt-latency-chart"></canvas>
                            </div>
                            <div class="metric-stats" id="stt-stats">
                                <span class="stat">P50: <strong>--</strong>ms</span>
                                <span class="stat">P95: <strong>--</strong>ms</span>
                                <span class="stat">Avg: <strong>--</strong>ms</span>
                            </div>
                        </div>
                        <!-- TTS Latency Chart -->
                        <div class="metric-chart">
                            <h4>üîä TTS Latency</h4>
                            <div class="chart-container">
                                <canvas id="tts-latency-chart"></canvas>
                            </div>
                            <div class="metric-stats" id="tts-stats">
                                <span class="stat">P50: <strong>--</strong>ms</span>
                                <span class="stat">P95: <strong>--</strong>ms</span>
                                <span class="stat">Avg: <strong>--</strong>ms</span>
                            </div>
                        </div>
                        <!-- LLM Latency Chart -->
                        <div class="metric-chart">
                            <h4>üß† LLM Latency</h4>
                            <div class="chart-container">
                                <canvas id="llm-latency-chart"></canvas>
                            </div>
                            <div class="metric-stats" id="llm-stats">
                                <span class="stat">P50: <strong>--</strong>ms</span>
                                <span class="stat">P95: <strong>--</strong>ms</span>
                                <span class="stat">Avg: <strong>--</strong>ms</span>
                            </div>
                        </div>
                        <!-- Pipeline Latency Chart -->
                        <div class="metric-chart">
                            <h4>‚ö° Pipeline Total</h4>
                            <div class="chart-container">
                                <canvas id="pipeline-latency-chart"></canvas>
                            </div>
                            <div class="metric-stats" id="pipeline-stats">
                                <span class="stat">P50: <strong>--</strong>ms</span>
                                <span class="stat">P95: <strong>--</strong>ms</span>
                                <span class="stat">Avg: <strong>--</strong>ms</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Log Stream -->
            <div class="card full-width">
                <div class="card-header">
                    <h3>üìú Log Stream</h3>
                    <div class="card-actions">
                        <select id="log-component-filter" class="filter-select">
                            <option value="">All Components</option>
                            <option value="stt">STT</option>
                            <option value="tts">TTS</option>
                            <option value="llm">LLM</option>
                            <option value="memory">Memory</option>
                            <option value="action">Action</option>
                            <option value="ha">Home Assistant</option>
                            <option value="system">System</option>
                        </select>
                        <select id="log-level-filter" class="filter-select">
                            <option value="">All Levels</option>
                            <option value="debug">Debug</option>
                            <option value="info">Info</option>
                            <option value="warn">Warning</option>
                            <option value="error">Error</option>
                        </select>
                        <input type="text" id="log-search" class="filter-search" placeholder="üîç Search logs...">
                        <button class="btn btn-small" id="export-logs">üì§ Export</button>
                        <button class="btn btn-small" id="clear-logs">üóëÔ∏è Clear</button>
                        <label class="toggle-label">
                            <input type="checkbox" id="log-auto-scroll" checked> Auto-scroll
                        </label>
                    </div>
                </div>
                <div class="card-body">
                    <div class="log-stream" id="log-stream">
                        <div class="log-entry info">
                            <span class="log-time">--:--:--</span>
                            <span class="log-level info">INFO</span>
                            <span class="log-component">system</span>
                            <span class="log-message">Connecting to log stream...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Prompts Page -->
        <div id="page-prompts" class="page">
            <div class="page-header">
                <h1>ü§ñ Agent System Prompts</h1>
                <p>View and edit the prompts that define each agent's behavior</p>
            </div>

            <!-- Agent Cards Grid -->
            <div class="prompts-grid" id="prompts-grid">
                <div class="loading-indicator">Loading prompts...</div>
            </div>

            <!-- Prompt Editor Modal -->
            <div id="prompt-modal" class="modal" style="display: none;">
                <div class="modal-content modal-large">
                    <div class="modal-header">
                        <div class="modal-title">
                            <span id="prompt-agent-icon">üéØ</span>
                            <div>
                                <h3 id="prompt-agent-name">Agent Prompt</h3>
                                <span class="text-muted" id="prompt-agent-description">Description</span>
                            </div>
                        </div>
                        <div class="modal-actions">
                            <button class="btn btn-small btn-secondary" id="prompt-history-btn">üìú History</button>
                            <button class="btn btn-small" id="close-prompt-modal">‚úï</button>
                        </div>
                    </div>
                    <div class="modal-body">
                        <div class="prompt-editor-container">
                            <div class="editor-toolbar">
                                <span class="editor-info">
                                    <span id="prompt-char-count">0</span> characters
                                    | Version <span id="prompt-version">1</span>
                                </span>
                                <div class="editor-actions">
                                    <button class="btn btn-small btn-secondary" id="prompt-reset-btn">‚Ü©Ô∏è Reset</button>
                                    <button class="btn btn-small btn-primary" id="prompt-save-btn">üíæ Save</button>
                                </div>
                            </div>
                            <textarea id="prompt-editor" class="prompt-editor"
                                placeholder="Enter prompt content..."></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Prompt History Modal -->
            <div id="prompt-history-modal" class="modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>üìú Prompt History</h3>
                        <button class="btn btn-small" id="close-history-modal">‚úï</button>
                    </div>
                    <div class="modal-body">
                        <div class="history-list" id="prompt-history-list">
                            <p class="text-muted">No history available</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Setup & Test Page -->
        <div id="page-setup" class="page">
            <div class="page-header">
                <h1>‚ö° Setup & Test</h1>
                <p>Configure and test core functionality for TTS, LLM, and STT systems</p>
            </div>

            <div class="setup-grid">
                <!-- TTS Config -->
                <div class="card">
                    <div class="card-header">
                        <h3>üîä Text-to-Speech</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>TTS Backend</label>
                            <select id="tts-backend" class="form-control">
                                <option value="kokoro">Kokoro (Local)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Voice</label>
                            <select id="tts-voice" class="form-control">
                                <option value="bm_fable">bm_fable (British Male)</option>
                                <option value="af_bella">af_bella (American Female)</option>
                                <option value="am_adam">am_adam (American Male)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Test Text</label>
                            <input type="text" id="tts-test-text" class="form-control"
                                value="Hello! I'm Barnabee, your friendly home assistant.">
                        </div>
                        <button class="btn btn-primary" id="test-tts">üîä Test TTS</button>
                        <div id="tts-result" class="test-result"></div>
                    </div>
                </div>

                <!-- LLM Config -->
                <div class="card">
                    <div class="card-header">
                        <h3>üß† Language Model</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>Provider</label>
                            <select id="llm-provider" class="form-control">
                                <option value="openrouter">OpenRouter</option>
                                <option value="openai">OpenAI</option>
                                <option value="anthropic">Anthropic</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>API Key</label>
                            <input type="password" id="llm-api-key" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        </div>
                        <div class="form-group">
                            <label>Test Prompt</label>
                            <input type="text" id="llm-test-prompt" class="form-control" value="What time is it?">
                        </div>
                        <button class="btn btn-primary" id="test-llm">üß† Test LLM</button>
                        <div id="llm-result" class="test-result"></div>
                    </div>
                </div>

                <!-- STT Config -->
                <div class="card">
                    <div class="card-header">
                        <h3>üé§ Speech Recognition</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>STT Backend</label>
                            <select id="stt-backend" class="form-control">
                                <option value="gpu">GPU Worker (Parakeet)</option>
                                <option value="cpu">CPU (Distil-Whisper)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>GPU Worker URL</label>
                            <input type="text" id="stt-gpu-url" class="form-control" value="http://192.168.86.61:8001">
                        </div>
                        <div class="status-row">
                            <span class="status-label">GPU Worker:</span>
                            <span class="status-value" id="gpu-worker-status">Checking...</span>
                        </div>
                        <button class="btn btn-primary" id="test-stt">üé§ Test STT</button>
                        <div id="stt-result" class="test-result"></div>
                    </div>
                </div>
            </div>

            <!-- Voice Pipeline Test -->
            <div class="card full-width">
                <div class="card-header">
                    <h3>üéôÔ∏è Full Voice Pipeline Test</h3>
                </div>
                <div class="card-body">
                    <p>Test the complete voice pipeline: Speech ‚Üí AI ‚Üí Response ‚Üí Speech</p>
                    <div class="pipeline-test">
                        <div class="form-group">
                            <label>Test Input (simulated speech)</label>
                            <input type="text" id="pipeline-input" class="form-control"
                                value="Turn on the living room lights">
                        </div>
                        <button class="btn btn-primary btn-large" id="test-pipeline">
                            üöÄ Test Full Pipeline
                        </button>
                    </div>
                    <div id="pipeline-result" class="test-result"></div>
                </div>
            </div>

            <!-- E2E Test Suite -->
            <div class="card full-width">
                <div class="card-header">
                    <h3>üß™ End-to-End Test Suite</h3>
                    <div class="card-actions">
                        <button class="btn btn-small" id="e2e-quick-test">‚ö° Quick Test</button>
                        <button class="btn btn-small btn-primary" id="e2e-run-suite">üöÄ Run Full Suite</button>
                    </div>
                </div>
                <div class="card-body">
                    <p>Automated testing of the voice pipeline. Results appear in the activity feed.</p>

                    <div class="e2e-controls">
                        <div class="form-group">
                            <label>Test Categories</label>
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="e2e-cat-instant" checked> Instant (time, math, greetings)
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="e2e-cat-action" checked> Action (device control)
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="e2e-cat-interaction"> Interaction (LLM required)
                                </label>
                            </div>
                        </div>
                    </div>

                    <div id="e2e-status" class="e2e-status" style="display: none;">
                        <div class="e2e-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="e2e-progress-fill" style="width: 0%"></div>
                            </div>
                            <span id="e2e-progress-text">0/0</span>
                        </div>
                    </div>

                    <div id="e2e-results" class="e2e-results" style="display: none;">
                        <div class="e2e-summary">
                            <div class="e2e-stat passed">
                                <span class="e2e-stat-value" id="e2e-passed">0</span>
                                <span class="e2e-stat-label">Passed</span>
                            </div>
                            <div class="e2e-stat failed">
                                <span class="e2e-stat-value" id="e2e-failed">0</span>
                                <span class="e2e-stat-label">Failed</span>
                            </div>
                            <div class="e2e-stat">
                                <span class="e2e-stat-value" id="e2e-latency">0</span>
                                <span class="e2e-stat-label">Total ms</span>
                            </div>
                        </div>
                        <div class="e2e-test-list" id="e2e-test-list">
                            <!-- Test results populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Family Page -->
        <div id="page-family" class="page">
            <div class="page-header">
                <h1>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family Profiles</h1>
                <p>Manage family member profiles and preferences</p>
            </div>

            <div class="family-grid" id="family-list">
                <!-- Family members will be populated here -->
                <div class="card family-card">
                    <div class="family-avatar">üë®</div>
                    <h4>Thom</h4>
                    <p class="text-muted">Admin</p>
                    <div class="family-prefs">
                        <span class="pref-tag">Morning Person</span>
                    </div>
                </div>
                <div class="card family-card">
                    <div class="family-avatar">üë©</div>
                    <h4>Elizabeth</h4>
                    <p class="text-muted">Adult</p>
                    <div class="family-prefs">
                        <span class="pref-tag">Night Owl</span>
                    </div>
                </div>
                <div class="card family-card">
                    <div class="family-avatar">üëß</div>
                    <h4>Viola</h4>
                    <p class="text-muted">Child</p>
                    <div class="family-prefs">
                        <span class="pref-tag">Bedtime: 8pm</span>
                    </div>
                </div>
                <div class="card family-card">
                    <div class="family-avatar">üë¶</div>
                    <h4>Xander</h4>
                    <p class="text-muted">Child</p>
                    <div class="family-prefs">
                        <span class="pref-tag">Bedtime: 8pm</span>
                    </div>
                </div>
                <div class="card family-card">
                    <div class="family-avatar">üë∂</div>
                    <h4>Penelope</h4>
                    <p class="text-muted">Toddler</p>
                    <div class="family-prefs">
                        <span class="pref-tag">Bedtime: 7pm</span>
                    </div>
                </div>
                <div class="card family-card">
                    <div class="family-avatar">üë∂</div>
                    <h4>Zachary</h4>
                    <p class="text-muted">Toddler</p>
                    <div class="family-prefs">
                        <span class="pref-tag">Bedtime: 7pm</span>
                    </div>
                </div>
                <div class="card family-card add-new">
                    <div class="family-avatar">‚ûï</div>
                    <h4>Add Member</h4>
                </div>
            </div>
        </div>

        <!-- Entities Page (Home Assistant Dashboard) -->
        <div id="page-entities" class="page">
            <div class="page-header">
                <h1>üè† What Barnabee Knows</h1>
                <p>Barnabee's understanding of your Home Assistant environment</p>
            </div>

            <!-- Discovery Status Banner -->
            <div class="card ha-status-banner">
                <div id="ha-connection-status">
                    <div class="ha-status-disconnected">
                        <span class="status-indicator disconnected"></span>
                        <span class="status-text">Checking connection...</span>
                    </div>
                </div>
                <div id="ha-snapshot-summary"></div>
            </div>

            <!-- HA Tab Navigation -->
            <div class="ha-tabs">
                <button class="ha-tab-btn active" data-ha-tab="overview">üìä Overview</button>
                <button class="ha-tab-btn" data-ha-tab="entities">üí° Entities</button>
                <button class="ha-tab-btn" data-ha-tab="areas">üó∫Ô∏è Areas</button>
                <button class="ha-tab-btn" data-ha-tab="devices">üì± Devices</button>
                <button class="ha-tab-btn" data-ha-tab="activity">üìã Activity Log</button>
            </div>

            <!-- Overview Tab (NEW) -->
            <div id="ha-tab-overview" class="ha-tab-content active">
                <div class="ha-overview-grid">
                    <!-- Discovery Status -->
                    <div class="card">
                        <div class="card-header">
                            <h3>üîÑ Discovery Status</h3>
                        </div>
                        <div class="card-body" id="ha-discovery-status">
                            <div class="discovery-stats">
                                <div class="discovery-stat">
                                    <span class="stat-label">Last Sync</span>
                                    <span class="stat-value" id="ha-last-sync">Never</span>
                                </div>
                                <div class="discovery-stat">
                                    <span class="stat-label">Entities Known</span>
                                    <span class="stat-value" id="ha-entity-count">0</span>
                                </div>
                                <div class="discovery-stat">
                                    <span class="stat-label">Areas Mapped</span>
                                    <span class="stat-value" id="ha-area-count">0</span>
                                </div>
                                <div class="discovery-stat">
                                    <span class="stat-label">Devices Found</span>
                                    <span class="stat-value" id="ha-device-count">0</span>
                                </div>
                            </div>
                            <button class="btn" id="ha-sync-now">üîÑ Sync Now</button>
                        </div>
                    </div>

                    <!-- Domain Breakdown -->
                    <div class="card">
                        <div class="card-header">
                            <h3>üìä What Barnabee Can Control</h3>
                        </div>
                        <div class="card-body">
                            <div class="domain-counts" id="ha-domain-counts">
                                <p class="text-muted">Connect to Home Assistant to see domain statistics</p>
                            </div>
                        </div>
                    </div>

                    <!-- Recent HA Activity -->
                    <div class="card full-width">
                        <div class="card-header">
                            <h3>üìã Recent Barnabee Actions</h3>
                        </div>
                        <div class="card-body">
                            <div class="ha-recent-activity" id="ha-recent-activity">
                                <p class="text-muted">No recent Home Assistant activity</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Entities Tab -->
            <div id="ha-tab-entities" class="ha-tab-content">
                <div class="entities-toolbar">
                    <input type="text" id="entity-search" class="form-control"
                        placeholder="üîç Search entities Barnabee knows about...">
                    <select id="entity-type-filter" class="filter-select">
                        <option value="">All Types</option>
                        <option value="light">Lights</option>
                        <option value="switch">Switches</option>
                        <option value="climate">Climate</option>
                        <option value="sensor">Sensors</option>
                        <option value="binary_sensor">Binary Sensors</option>
                        <option value="media_player">Media Players</option>
                        <option value="cover">Covers</option>
                        <option value="fan">Fans</option>
                        <option value="lock">Locks</option>
                    </select>
                    <select id="entity-area-filter" class="filter-select">
                        <option value="">All Areas</option>
                    </select>
                </div>

                <div class="entities-grid" id="entities-list">
                    <div class="empty-state">
                        <p class="text-muted">Loading entities...</p>
                    </div>
                </div>
            </div>

            <!-- Areas Tab -->
            <div id="ha-tab-areas" class="ha-tab-content">
                <div class="areas-grid" id="ha-areas-list">
                    <div class="empty-state">
                        <p class="text-muted">Loading areas...</p>
                    </div>
                </div>
            </div>

            <!-- Devices Tab -->
            <div id="ha-tab-devices" class="ha-tab-content">
                <div class="devices-grid" id="ha-devices-list">
                    <div class="empty-state">
                        <p class="text-muted">Loading devices...</p>
                    </div>
                </div>
            </div>

            <!-- Activity Log Tab (replaces Logs/Automations) -->
            <div id="ha-tab-activity" class="ha-tab-content">
                <div class="ha-activity-header">
                    <h3>Barnabee's Home Assistant Activity</h3>
                    <p class="text-muted">All actions Barnabee has taken through Home Assistant</p>
                </div>
                <div class="ha-activity-log" id="ha-activity-log">
                    <div class="empty-state">
                        <p class="text-muted">No activity yet. Talk to Barnabee to control your home!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configuration Page -->
        <div id="page-config" class="page">
            <div class="page-header">
                <h1>‚öôÔ∏è Configuration</h1>
                <p>Manage LLM providers and system configuration</p>
            </div>

            <div class="config-layout">
                <div class="config-sidebar">
                    <h4>Categories</h4>
                    <ul class="config-nav">
                        <li class="active" data-config="providers">ü§ñ LLM Providers</li>
                        <li data-config="models">üß† Model Selection</li>
                        <li data-config="general">üîß General Settings</li>
                        <li data-config="voice">üé§ Voice Settings</li>
                        <li data-config="homeassistant">üè† Home Assistant</li>
                        <li data-config="memory">üíæ Memory</li>
                        <li data-config="advanced">‚ö° Advanced</li>
                    </ul>
                </div>
                <div class="config-content">
                    <!-- LLM Providers Section -->
                    <div id="config-providers" class="config-section active">
                        <h3>ü§ñ LLM Provider Configuration</h3>
                        <p class="section-desc">Configure API keys for LLM providers. Keys are encrypted and stored
                            securely.</p>

                        <div class="provider-status-bar">
                            <span id="providers-configured">0</span> configured &nbsp;|&nbsp;
                            <span id="providers-enabled">0</span> enabled
                            <button class="btn btn-small" id="refresh-providers" style="margin-left: 16px;">üîÑ
                                Refresh</button>
                        </div>

                        <div class="providers-grid" id="providers-list">
                            <!-- Populated dynamically -->
                            <div class="loading-spinner">Loading providers...</div>
                        </div>
                    </div>

                    <!-- Provider Setup Modal -->
                    <div id="provider-modal" class="modal" style="display: none;">
                        <div class="modal-content modal-large">
                            <div class="modal-header">
                                <h3 id="provider-modal-title">Configure Provider</h3>
                                <button class="btn btn-small" id="close-provider-modal">‚úï</button>
                            </div>
                            <div class="modal-body">
                                <div class="provider-setup-grid">
                                    <div class="provider-instructions">
                                        <h4>üìã Setup Instructions</h4>
                                        <ol id="provider-setup-steps">
                                            <!-- Populated dynamically -->
                                        </ol>
                                        <div class="provider-links">
                                            <a id="provider-docs-link" href="#" target="_blank" class="btn btn-small">üìñ
                                                Documentation</a>
                                            <a id="provider-key-link" href="#" target="_blank"
                                                class="btn btn-small btn-primary">üîë Get API Key</a>
                                        </div>
                                    </div>
                                    <div class="provider-form">
                                        <h4>üîê Credentials</h4>
                                        <form id="provider-setup-form">
                                            <input type="hidden" id="provider-type">
                                            <div id="provider-secret-fields">
                                                <!-- Secret fields populated dynamically -->
                                            </div>
                                            <div id="provider-config-fields">
                                                <!-- Config fields populated dynamically -->
                                            </div>
                                            <div class="form-actions">
                                                <button type="button" class="btn" id="test-provider-btn">üß™ Test
                                                    Connection</button>
                                                <button type="submit" class="btn btn-primary">üíæ Save & Enable</button>
                                            </div>
                                        </form>
                                        <div id="provider-test-result" class="test-result" style="display: none;"></div>
                                    </div>
                                </div>
                                <div class="provider-pricing" id="provider-pricing">
                                    <!-- Pricing notes -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="config-general" class="config-section">
                        <h3>General Settings</h3>
                        <div class="form-group">
                            <label>Assistant Name</label>
                            <input type="text" class="form-control" value="Barnabee">
                        </div>
                        <div class="form-group">
                            <label>Wake Word</label>
                            <input type="text" class="form-control" value="Hey Barnabee">
                        </div>
                        <div class="form-group">
                            <label>Environment</label>
                            <select class="form-control">
                                <option value="development">Development</option>
                                <option value="production">Production</option>
                            </select>
                        </div>
                        <button class="btn btn-primary">üíæ Save Settings</button>
                    </div>

                    <!-- Model Selection Section -->
                    <div id="config-models" class="config-section">
                        <h3>üß† Model Selection</h3>
                        <p class="section-desc">Configure which models are used for each activity. Use free models
                            during testing to save costs.</p>

                        <!-- Mode Toggle -->
                        <div class="mode-toggle-container">
                            <div class="mode-toggle">
                                <button class="mode-btn active" data-mode="testing" id="mode-testing">
                                    üß™ Testing Mode
                                    <span class="mode-desc">Free models</span>
                                </button>
                                <button class="mode-btn" data-mode="production" id="mode-production">
                                    üöÄ Production Mode
                                    <span class="mode-desc">Best quality</span>
                                </button>
                            </div>
                            <div class="mode-status" id="mode-status">
                                <span class="mode-label">Current:</span>
                                <span class="mode-value" id="current-mode-display">Testing</span>
                            </div>
                        </div>

                        <div class="models-toolbar">
                            <div class="models-filter">
                                <label>
                                    <input type="checkbox" id="show-free-only"> Show free models only
                                </label>
                                <span class="models-count" id="models-count-display">Loading models...</span>
                            </div>
                            <div class="models-actions">
                                <button class="btn btn-small btn-auto" id="auto-select-models"
                                    title="Use AI to select optimal models for each activity">
                                    ü§ñ Auto-Select
                                </button>
                                <button class="btn btn-small" id="check-model-health"
                                    title="Test which models are currently working">
                                    ü©∫ Health Check
                                </button>
                                <button class="btn btn-small" id="refresh-models">üîÑ Refresh</button>
                            </div>
                        </div>

                        <!-- Model Health Status (hidden by default) -->
                        <div class="model-health-status" id="model-health-status" style="display: none;">
                            <div class="health-header">
                                <span>Model Health Status</span>
                                <button class="btn-close" id="close-health-status">&times;</button>
                            </div>
                            <div class="health-content" id="health-content">
                                Checking models...
                            </div>
                        </div>

                        <div class="activities-list" id="activities-list">
                            <div class="loading-spinner">Loading activities...</div>
                        </div>
                    </div>
                    <div id="config-voice" class="config-section">
                        <h3>Voice Settings</h3>
                        <p class="text-muted">Configure TTS and STT preferences</p>
                    </div>
                    <div id="config-homeassistant" class="config-section">
                        <h3>üè† Home Assistant</h3>
                        <p class="section-desc">Configure connection to your Home Assistant instance.</p>

                        <!-- Connection Status -->
                        <div class="ha-config-status" id="ha-config-connection-status">
                            <div class="ha-status-disconnected">
                                <span class="status-indicator disconnected"></span>
                                <span class="status-text">Not Configured</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Home Assistant URL</label>
                            <input type="text" id="ha-url-input" class="form-control"
                                placeholder="http://192.168.1.100:8123">
                            <small class="form-text">The URL of your Home Assistant instance (e.g.,
                                http://192.168.86.50:8123)</small>
                        </div>
                        <div class="form-group">
                            <label>Long-Lived Access Token</label>
                            <input type="password" id="ha-token-input" class="form-control"
                                placeholder="Paste your token here...">
                            <small class="form-text">Generate in Home Assistant: Profile ‚Üí Long-Lived Access
                                Tokens</small>
                        </div>
                        <div class="form-actions">
                            <button class="btn" id="test-ha-connection">üîó Test Connection</button>
                            <button class="btn btn-primary" id="save-ha-config">üíæ Save</button>
                        </div>
                        <div id="ha-test-result" class="test-result" style="display: none;"></div>

                        <hr>

                        <h4>üìã Setup Instructions</h4>
                        <ol class="setup-steps">
                            <li>Open your Home Assistant instance in a browser</li>
                            <li>Click your <strong>Profile</strong> (your name in the bottom left)</li>
                            <li>Scroll down to <strong>Long-Lived Access Tokens</strong></li>
                            <li>Click <strong>Create Token</strong></li>
                            <li>Name it "BarnabeeNet" and click <strong>OK</strong></li>
                            <li>Copy the token and paste it in the field above</li>
                            <li>Click <strong>Test Connection</strong> to verify</li>
                            <li>Click <strong>Save</strong> to store the configuration</li>
                        </ol>
                    </div>
                    <div id="config-memory" class="config-section">
                        <h3>Memory Settings</h3>
                        <p class="text-muted">Configure memory storage and retrieval</p>
                    </div>
                    <div id="config-advanced" class="config-section">
                        <h3>Advanced Settings</h3>
                        <p class="text-muted">Advanced configuration options</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="/static/app.js"></script>
</body>

</html>
