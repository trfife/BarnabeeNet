<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BarnabeeNet Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <nav class="navbar">
        <div class="nav-brand">
            <span class="logo">üêù</span>
            <span class="brand-name">BarnabeeNet Dashboard</span>
        </div>
        <div class="nav-links">
            <a href="#" class="nav-link active" data-page="dashboard">Dashboard</a>
            <a href="#" class="nav-link" data-page="setup">Setup & Test</a>
            <a href="#" class="nav-link" data-page="family">Family</a>
            <a href="#" class="nav-link" data-page="entities">Entities</a>
            <a href="#" class="nav-link" data-page="config">Configuration</a>
        </div>
        <div class="nav-status">
            <span class="status-indicator" id="ws-status"></span>
            <span id="current-time"></span>
        </div>
    </nav>

    <main class="main-content">
        <!-- Dashboard Page -->
        <div id="page-dashboard" class="page active">
            <div class="page-header">
                <h1>BarnabeeNet Dashboard</h1>
                <p>Monitor your smart home AI system status and activity</p>
            </div>

            <div class="dashboard-grid">
                <!-- System Status -->
                <div class="card">
                    <div class="card-header">
                        <h3>üñ•Ô∏è System Status</h3>
                    </div>
                    <div class="card-body" id="system-status">
                        <div class="status-row">
                            <span class="status-label">Status:</span>
                            <span class="status-value status-loading">Loading...</span>
                        </div>
                    </div>
                </div>

                <!-- Services Health -->
                <div class="card">
                    <div class="card-header">
                        <h3>üíö Services</h3>
                    </div>
                    <div class="card-body" id="services-health">
                        <div class="status-row">
                            <span class="status-label">Loading...</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="card">
                    <div class="card-header">
                        <h3>üìä Statistics</h3>
                    </div>
                    <div class="card-body" id="quick-stats">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="stat-value" id="stat-requests">-</span>
                                <span class="stat-label">Requests</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value" id="stat-signals">-</span>
                                <span class="stat-label">Signals</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value" id="stat-memories">-</span>
                                <span class="stat-label">Memories</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value" id="stat-actions">-</span>
                                <span class="stat-label">Actions</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Errors -->
                <div class="card">
                    <div class="card-header">
                        <h3>‚ö†Ô∏è Recent Errors</h3>
                    </div>
                    <div class="card-body" id="recent-errors">
                        <p class="text-muted">No recent errors</p>
                    </div>
                </div>
            </div>

            <!-- Activity Feed -->
            <div class="card full-width">
                <div class="card-header">
                    <h3>üì° Live Activity Feed</h3>
                    <div class="card-actions">
                        <select id="activity-filter" class="filter-select">
                            <option value="">All Types</option>
                            <option value="request_start">Requests</option>
                            <option value="stt">STT</option>
                            <option value="meta_classify">Classification</option>
                            <option value="llm_request">LLM Calls</option>
                            <option value="ha_service_call">HA Actions</option>
                            <option value="memory">Memory</option>
                            <option value="tts">TTS</option>
                            <option value="error">Errors</option>
                        </select>
                        <button class="btn btn-small" id="clear-activity">Clear</button>
                        <label class="toggle-label">
                            <input type="checkbox" id="auto-scroll" checked>
                            Auto-scroll
                        </label>
                    </div>
                </div>
                <div class="card-body">
                    <div class="activity-feed" id="activity-feed">
                        <div class="activity-item info">
                            <span class="activity-time">--:--:--</span>
                            <span class="activity-badge system">System</span>
                            <span class="activity-message">Connecting to activity stream...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Request Traces -->
            <div class="card full-width">
                <div class="card-header">
                    <h3>üîç Recent Request Traces</h3>
                    <div class="card-actions">
                        <button class="btn btn-small" id="refresh-traces">üîÑ Refresh</button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="traces-list" id="traces-list">
                        <p class="text-muted">Loading traces...</p>
                    </div>
                </div>
            </div>

            <!-- Trace Detail Modal -->
            <div id="trace-modal" class="modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>üî¨ Request Trace Detail</h3>
                        <button class="btn btn-small" id="close-modal">‚úï</button>
                    </div>
                    <div class="modal-body" id="trace-detail">
                        <!-- Populated dynamically -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Setup & Test Page -->
        <div id="page-setup" class="page">
            <div class="page-header">
                <h1>‚ö° Setup & Test</h1>
                <p>Configure and test core functionality for TTS, LLM, and STT systems</p>
            </div>

            <div class="setup-grid">
                <!-- TTS Config -->
                <div class="card">
                    <div class="card-header">
                        <h3>üîä Text-to-Speech</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>TTS Backend</label>
                            <select id="tts-backend" class="form-control">
                                <option value="kokoro">Kokoro (Local)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Voice</label>
                            <select id="tts-voice" class="form-control">
                                <option value="bm_fable">bm_fable (British Male)</option>
                                <option value="af_bella">af_bella (American Female)</option>
                                <option value="am_adam">am_adam (American Male)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Test Text</label>
                            <input type="text" id="tts-test-text" class="form-control"
                                value="Hello! I'm Barnabee, your friendly home assistant.">
                        </div>
                        <button class="btn btn-primary" id="test-tts">üîä Test TTS</button>
                        <div id="tts-result" class="test-result"></div>
                    </div>
                </div>

                <!-- LLM Config -->
                <div class="card">
                    <div class="card-header">
                        <h3>üß† Language Model</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>Provider</label>
                            <select id="llm-provider" class="form-control">
                                <option value="openrouter">OpenRouter</option>
                                <option value="openai">OpenAI</option>
                                <option value="anthropic">Anthropic</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>API Key</label>
                            <input type="password" id="llm-api-key" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        </div>
                        <div class="form-group">
                            <label>Test Prompt</label>
                            <input type="text" id="llm-test-prompt" class="form-control" value="What time is it?">
                        </div>
                        <button class="btn btn-primary" id="test-llm">üß† Test LLM</button>
                        <div id="llm-result" class="test-result"></div>
                    </div>
                </div>

                <!-- STT Config -->
                <div class="card">
                    <div class="card-header">
                        <h3>üé§ Speech Recognition</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>STT Backend</label>
                            <select id="stt-backend" class="form-control">
                                <option value="gpu">GPU Worker (Parakeet)</option>
                                <option value="cpu">CPU (Distil-Whisper)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>GPU Worker URL</label>
                            <input type="text" id="stt-gpu-url" class="form-control" value="http://192.168.86.61:8001">
                        </div>
                        <div class="status-row">
                            <span class="status-label">GPU Worker:</span>
                            <span class="status-value" id="gpu-worker-status">Checking...</span>
                        </div>
                        <button class="btn btn-primary" id="test-stt">üé§ Test STT</button>
                        <div id="stt-result" class="test-result"></div>
                    </div>
                </div>
            </div>

            <!-- Voice Pipeline Test -->
            <div class="card full-width">
                <div class="card-header">
                    <h3>üéôÔ∏è Full Voice Pipeline Test</h3>
                </div>
                <div class="card-body">
                    <p>Test the complete voice pipeline: Speech ‚Üí AI ‚Üí Response ‚Üí Speech</p>
                    <div class="pipeline-test">
                        <div class="form-group">
                            <label>Test Input (simulated speech)</label>
                            <input type="text" id="pipeline-input" class="form-control"
                                value="Turn on the living room lights">
                        </div>
                        <button class="btn btn-primary btn-large" id="test-pipeline">
                            üöÄ Test Full Pipeline
                        </button>
                    </div>
                    <div id="pipeline-result" class="test-result"></div>
                </div>
            </div>

            <!-- E2E Test Suite -->
            <div class="card full-width">
                <div class="card-header">
                    <h3>üß™ End-to-End Test Suite</h3>
                    <div class="card-actions">
                        <button class="btn btn-small" id="e2e-quick-test">‚ö° Quick Test</button>
                        <button class="btn btn-small btn-primary" id="e2e-run-suite">üöÄ Run Full Suite</button>
                    </div>
                </div>
                <div class="card-body">
                    <p>Automated testing of the voice pipeline. Results appear in the activity feed.</p>

                    <div class="e2e-controls">
                        <div class="form-group">
                            <label>Test Categories</label>
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="e2e-cat-instant" checked> Instant (time, math, greetings)
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="e2e-cat-action" checked> Action (device control)
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="e2e-cat-interaction"> Interaction (LLM required)
                                </label>
                            </div>
                        </div>
                    </div>

                    <div id="e2e-status" class="e2e-status" style="display: none;">
                        <div class="e2e-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="e2e-progress-fill" style="width: 0%"></div>
                            </div>
                            <span id="e2e-progress-text">0/0</span>
                        </div>
                    </div>

                    <div id="e2e-results" class="e2e-results" style="display: none;">
                        <div class="e2e-summary">
                            <div class="e2e-stat passed">
                                <span class="e2e-stat-value" id="e2e-passed">0</span>
                                <span class="e2e-stat-label">Passed</span>
                            </div>
                            <div class="e2e-stat failed">
                                <span class="e2e-stat-value" id="e2e-failed">0</span>
                                <span class="e2e-stat-label">Failed</span>
                            </div>
                            <div class="e2e-stat">
                                <span class="e2e-stat-value" id="e2e-latency">0</span>
                                <span class="e2e-stat-label">Total ms</span>
                            </div>
                        </div>
                        <div class="e2e-test-list" id="e2e-test-list">
                            <!-- Test results populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Family Page -->
        <div id="page-family" class="page">
            <div class="page-header">
                <h1>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family Profiles</h1>
                <p>Manage family member profiles and preferences</p>
            </div>

            <div class="family-grid" id="family-list">
                <!-- Family members will be populated here -->
                <div class="card family-card">
                    <div class="family-avatar">üë®</div>
                    <h4>Thom</h4>
                    <p class="text-muted">Admin</p>
                    <div class="family-prefs">
                        <span class="pref-tag">Morning Person</span>
                    </div>
                </div>
                <div class="card family-card">
                    <div class="family-avatar">üë©</div>
                    <h4>Elizabeth</h4>
                    <p class="text-muted">Adult</p>
                    <div class="family-prefs">
                        <span class="pref-tag">Night Owl</span>
                    </div>
                </div>
                <div class="card family-card">
                    <div class="family-avatar">üëß</div>
                    <h4>Viola</h4>
                    <p class="text-muted">Child</p>
                    <div class="family-prefs">
                        <span class="pref-tag">Bedtime: 8pm</span>
                    </div>
                </div>
                <div class="card family-card">
                    <div class="family-avatar">üë¶</div>
                    <h4>Xander</h4>
                    <p class="text-muted">Child</p>
                    <div class="family-prefs">
                        <span class="pref-tag">Bedtime: 8pm</span>
                    </div>
                </div>
                <div class="card family-card">
                    <div class="family-avatar">üë∂</div>
                    <h4>Penelope</h4>
                    <p class="text-muted">Toddler</p>
                    <div class="family-prefs">
                        <span class="pref-tag">Bedtime: 7pm</span>
                    </div>
                </div>
                <div class="card family-card">
                    <div class="family-avatar">üë∂</div>
                    <h4>Zachary</h4>
                    <p class="text-muted">Toddler</p>
                    <div class="family-prefs">
                        <span class="pref-tag">Bedtime: 7pm</span>
                    </div>
                </div>
                <div class="card family-card add-new">
                    <div class="family-avatar">‚ûï</div>
                    <h4>Add Member</h4>
                </div>
            </div>
        </div>

        <!-- Entities Page -->
        <div id="page-entities" class="page">
            <div class="page-header">
                <h1>üè† Home Assistant Entities</h1>
                <p>View and control connected devices</p>
            </div>

            <!-- Connection Status Banner -->
            <div class="card ha-status-banner">
                <div id="ha-connection-status">
                    <div class="ha-status-disconnected">
                        <span class="status-indicator disconnected"></span>
                        <span class="status-text">Checking connection...</span>
                    </div>
                </div>
                <div id="ha-snapshot-summary"></div>
            </div>

            <!-- Entity Browser -->
            <div class="entities-toolbar">
                <input type="text" id="entity-search" class="form-control" placeholder="üîç Search entities...">
                <select id="entity-type-filter" class="filter-select">
                    <option value="">All Types</option>
                    <option value="light">Lights</option>
                    <option value="switch">Switches</option>
                    <option value="climate">Climate</option>
                    <option value="sensor">Sensors</option>
                    <option value="media_player">Media Players</option>
                </select>
                <select id="entity-area-filter" class="filter-select">
                    <option value="">All Areas</option>
                </select>
                <button class="btn" id="refresh-entities">üîÑ Refresh</button>
            </div>

            <div class="entities-grid" id="entities-list">
                <div class="empty-state">
                    <p class="text-muted">Loading entities...</p>
                </div>
            </div>

            <!-- Domain Overview -->
            <div class="card full-width">
                <div class="card-header">
                    <h3>üìä Domains Overview</h3>
                </div>
                <div class="card-body">
                    <div class="domain-counts" id="ha-domain-counts">
                        <p class="text-muted">Connect to Home Assistant to see domain statistics</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configuration Page -->
        <div id="page-config" class="page">
            <div class="page-header">
                <h1>‚öôÔ∏è Configuration</h1>
                <p>Manage LLM providers and system configuration</p>
            </div>

            <div class="config-layout">
                <div class="config-sidebar">
                    <h4>Categories</h4>
                    <ul class="config-nav">
                        <li class="active" data-config="providers">ü§ñ LLM Providers</li>
                        <li data-config="models">üß† Model Selection</li>
                        <li data-config="general">üîß General Settings</li>
                        <li data-config="voice">üé§ Voice Settings</li>
                        <li data-config="homeassistant">üè† Home Assistant</li>
                        <li data-config="memory">üíæ Memory</li>
                        <li data-config="advanced">‚ö° Advanced</li>
                    </ul>
                </div>
                <div class="config-content">
                    <!-- LLM Providers Section -->
                    <div id="config-providers" class="config-section active">
                        <h3>ü§ñ LLM Provider Configuration</h3>
                        <p class="section-desc">Configure API keys for LLM providers. Keys are encrypted and stored
                            securely.</p>

                        <div class="provider-status-bar">
                            <span id="providers-configured">0</span> configured &nbsp;|&nbsp;
                            <span id="providers-enabled">0</span> enabled
                            <button class="btn btn-small" id="refresh-providers" style="margin-left: 16px;">üîÑ
                                Refresh</button>
                        </div>

                        <div class="providers-grid" id="providers-list">
                            <!-- Populated dynamically -->
                            <div class="loading-spinner">Loading providers...</div>
                        </div>
                    </div>

                    <!-- Provider Setup Modal -->
                    <div id="provider-modal" class="modal" style="display: none;">
                        <div class="modal-content modal-large">
                            <div class="modal-header">
                                <h3 id="provider-modal-title">Configure Provider</h3>
                                <button class="btn btn-small" id="close-provider-modal">‚úï</button>
                            </div>
                            <div class="modal-body">
                                <div class="provider-setup-grid">
                                    <div class="provider-instructions">
                                        <h4>üìã Setup Instructions</h4>
                                        <ol id="provider-setup-steps">
                                            <!-- Populated dynamically -->
                                        </ol>
                                        <div class="provider-links">
                                            <a id="provider-docs-link" href="#" target="_blank" class="btn btn-small">üìñ
                                                Documentation</a>
                                            <a id="provider-key-link" href="#" target="_blank"
                                                class="btn btn-small btn-primary">üîë Get API Key</a>
                                        </div>
                                    </div>
                                    <div class="provider-form">
                                        <h4>üîê Credentials</h4>
                                        <form id="provider-setup-form">
                                            <input type="hidden" id="provider-type">
                                            <div id="provider-secret-fields">
                                                <!-- Secret fields populated dynamically -->
                                            </div>
                                            <div id="provider-config-fields">
                                                <!-- Config fields populated dynamically -->
                                            </div>
                                            <div class="form-actions">
                                                <button type="button" class="btn" id="test-provider-btn">üß™ Test
                                                    Connection</button>
                                                <button type="submit" class="btn btn-primary">üíæ Save & Enable</button>
                                            </div>
                                        </form>
                                        <div id="provider-test-result" class="test-result" style="display: none;"></div>
                                    </div>
                                </div>
                                <div class="provider-pricing" id="provider-pricing">
                                    <!-- Pricing notes -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="config-general" class="config-section">
                        <h3>General Settings</h3>
                        <div class="form-group">
                            <label>Assistant Name</label>
                            <input type="text" class="form-control" value="Barnabee">
                        </div>
                        <div class="form-group">
                            <label>Wake Word</label>
                            <input type="text" class="form-control" value="Hey Barnabee">
                        </div>
                        <div class="form-group">
                            <label>Environment</label>
                            <select class="form-control">
                                <option value="development">Development</option>
                                <option value="production">Production</option>
                            </select>
                        </div>
                        <button class="btn btn-primary">üíæ Save Settings</button>
                    </div>

                    <!-- Model Selection Section -->
                    <div id="config-models" class="config-section">
                        <h3>üß† Model Selection</h3>
                        <p class="section-desc">Configure which models are used for each activity. Use free models
                            during testing to save costs.</p>

                        <!-- Mode Toggle -->
                        <div class="mode-toggle-container">
                            <div class="mode-toggle">
                                <button class="mode-btn active" data-mode="testing" id="mode-testing">
                                    üß™ Testing Mode
                                    <span class="mode-desc">Free models</span>
                                </button>
                                <button class="mode-btn" data-mode="production" id="mode-production">
                                    üöÄ Production Mode
                                    <span class="mode-desc">Best quality</span>
                                </button>
                            </div>
                            <div class="mode-status" id="mode-status">
                                <span class="mode-label">Current:</span>
                                <span class="mode-value" id="current-mode-display">Testing</span>
                            </div>
                        </div>

                        <div class="models-toolbar">
                            <div class="models-filter">
                                <label>
                                    <input type="checkbox" id="show-free-only"> Show free models only
                                </label>
                                <span class="models-count" id="models-count-display">Loading models...</span>
                            </div>
                            <button class="btn btn-small" id="refresh-models">üîÑ Refresh Models</button>
                        </div>

                        <div class="activities-list" id="activities-list">
                            <div class="loading-spinner">Loading activities...</div>
                        </div>
                    </div>
                    <div id="config-voice" class="config-section">
                        <h3>Voice Settings</h3>
                        <p class="text-muted">Configure TTS and STT preferences</p>
                    </div>
                    <div id="config-homeassistant" class="config-section">
                        <h3>üè† Home Assistant</h3>
                        <p class="section-desc">Configure connection to your Home Assistant instance.</p>

                        <!-- Connection Status -->
                        <div class="ha-config-status" id="ha-config-connection-status">
                            <div class="ha-status-disconnected">
                                <span class="status-indicator disconnected"></span>
                                <span class="status-text">Checking connection...</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Home Assistant URL</label>
                            <input type="text" id="ha-url-input" class="form-control" placeholder="http://homeassistant.local:8123">
                            <small class="form-text">The URL of your Home Assistant instance</small>
                        </div>
                        <div class="form-group">
                            <label>Long-Lived Access Token</label>
                            <input type="password" id="ha-token-input" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                            <small class="form-text">Generate in Home Assistant: Profile ‚Üí Long-Lived Access Tokens</small>
                        </div>
                        <div class="form-actions">
                            <button class="btn" id="test-ha-connection">üîó Test Connection</button>
                            <button class="btn btn-primary" id="save-ha-config">üíæ Save</button>
                        </div>
                        <div id="ha-test-result" class="test-result" style="display: none;"></div>

                        <hr>

                        <h4>üìã Setup Instructions</h4>
                        <ol class="setup-steps">
                            <li>In Home Assistant, go to your <strong>Profile</strong> (click your name in sidebar)</li>
                            <li>Scroll down to <strong>Long-Lived Access Tokens</strong></li>
                            <li>Click <strong>Create Token</strong>, name it "BarnabeeNet"</li>
                            <li>Copy the token and paste it above</li>
                            <li>Set <code>HA_URL</code> and <code>HA_TOKEN</code> environment variables</li>
                        </ol>

                        <div class="info-box">
                            <strong>Note:</strong> Home Assistant connection is configured via environment variables. Set these in your .env file:
                            <pre>HA_URL=http://homeassistant.local:8123
HA_TOKEN=your_long_lived_access_token</pre>
                        </div>
                    </div>
                    <div id="config-memory" class="config-section">
                        <h3>Memory Settings</h3>
                        <p class="text-muted">Configure memory storage and retrieval</p>
                    </div>
                    <div id="config-advanced" class="config-section">
                        <h3>Advanced Settings</h3>
                        <p class="text-muted">Advanced configuration options</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="/static/app.js"></script>
</body>

</html>
